# Minute AI ì½”ë“œ ë¶„ì„ ê°€ì´ë“œë¼ì¸

> ë°œí‘œ ì§ˆì˜ì‘ë‹µ ëŒ€ë¹„ - íŒŒì¼ë³„ ì—­í•  ë° ì£¼ìš” í•¨ìˆ˜ ë¹ ë¥¸ ì°¸ì¡°
> ì‘ì„±ì¼: 2025-11-11

---

## ğŸ“‹ ëª©ì°¨

1. [Backend í•µì‹¬ íŒŒì¼](#1-backend-í•µì‹¬-íŒŒì¼)
2. [Frontend í•µì‹¬ íŒŒì¼](#2-frontend-í•µì‹¬-íŒŒì¼)
3. [Utils ëª¨ë“ˆ ìƒì„¸](#3-utils-ëª¨ë“ˆ-ìƒì„¸)
4. [Database ìŠ¤í‚¤ë§ˆ](#4-database-ìŠ¤í‚¤ë§ˆ)
5. [ë””ë²„ê¹… ê°€ì´ë“œ](#5-ë””ë²„ê¹…-ê°€ì´ë“œ)

---

## 1. Backend í•µì‹¬ íŒŒì¼

### 1.1 app.py (ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜)

**ì—­í• :** Flask ì• í”Œë¦¬ì¼€ì´ì…˜ ì§„ì…ì , ëª¨ë“  ë¼ìš°íŠ¸ ì •ì˜

**ì£¼ìš” ë¼ìš°íŠ¸ (í˜ì´ì§€)**

| ë¼ìš°íŠ¸ | í•¨ìˆ˜ | ì„¤ëª… | ê¶Œí•œ |
|--------|------|------|------|
| `/` | `index()` | íŒŒì¼ ì—…ë¡œë“œ í˜ì´ì§€ | @login_required |
| `/notes` | `list_notes()` | ë³¸ì¸ ë…¸íŠ¸ ëª©ë¡ | @login_required |
| `/shared-notes` | `shared_notes()` | ê³µìœ ë°›ì€ ë…¸íŠ¸ ëª©ë¡ | @login_required |
| `/view/<meeting_id>` | `view_meeting()` | íšŒì˜ë¡ ë·°ì–´ | @login_required + ê¶Œí•œ ì²´í¬ |
| `/login` | `login_page()` | ë¡œê·¸ì¸ í˜ì´ì§€ | ì—†ìŒ |

**ì£¼ìš” API ì—”ë“œí¬ì¸íŠ¸**

| ë¼ìš°íŠ¸ | ë¼ì¸ | í•¨ìˆ˜ | ì„¤ëª… | HTTP |
|--------|------|------|------|------|
| `/upload` | 334 | `upload_and_process()` | íŒŒì¼ ì—…ë¡œë“œ + STT + ìš”ì•½ (SSE) | POST |
| `/api/chat` | 824 | `chatbot_query()` | ì±—ë´‡ ì§ˆì˜ì‘ë‹µ | POST |
| `/api/delete_meeting` | 861 | `delete_meeting()` | ë…¸íŠ¸ ì‚­ì œ (SQLite + ChromaDB + íŒŒì¼) | POST |
| `/api/login` | 739 | `api_login()` | Firebase í† í° â†’ ì„¸ì…˜ ìƒì„± | POST |
| `/api/logout` | 771 | `api_logout()` | ì„¸ì…˜ ì œê±° | POST |
| `/api/meeting/<meeting_id>` | 604 | `get_meeting_data()` | íšŒì˜ ë°ì´í„° ì¡°íšŒ (JSON) | GET |
| `/api/check_duplicate` | 287 | `check_duplicate()` | íŒŒì¼ ì¤‘ë³µ ì²´í¬ (í•´ì‹œ ë¹„êµ) | POST |
| `/api/update_title` | 1010 | `update_meeting_title()` | ì œëª© ìˆ˜ì • (SQLite + ChromaDB) | POST |
| `/api/update_date` | 1049 | `update_meeting_date()` | ë‚ ì§œ ìˆ˜ì • (SQLite + ChromaDB) | POST |
| `/api/share_meeting` | 909 | `share_meeting_api()` | ë…¸íŠ¸ ê³µìœ  | POST |

**í•µì‹¬ ì½”ë“œ ë¸”ë¡**

```python
# ë¼ì¸ 334: íŒŒì¼ ì—…ë¡œë“œ + ì „ì²´ íŒŒì´í”„ë¼ì¸ (SSE)
@app.route('/upload', methods=['POST'])
@login_required
def upload_and_process():
    # SSE (Server-Sent Events) ì‚¬ìš©
    # ë‹¨ê³„: upload â†’ stt â†’ summary â†’ mindmap
    # ì‹¤ì‹œê°„ ì§„í–‰ ìƒíƒœ ì „ì†¡: yield f"data: {json.dumps(...)}\n\n"
```

```python
# ë¼ì¸ 824: ì±—ë´‡ ì§ˆì˜ì‘ë‹µ
@app.route('/api/chat', methods=['POST'])
@login_required
def chatbot_query():
    # 1. ì ‘ê·¼ ê°€ëŠ¥í•œ meeting_id ì¡°íšŒ (ë³¸ì¸ + ê³µìœ ë°›ì€ ë…¸íŠ¸)
    # 2. ChatManager.process_query() í˜¸ì¶œ
    # 3. ë‹µë³€ + ì¶œì²˜ ë°˜í™˜
```

```python
# ë¼ì¸ 604: íšŒì˜ ë°ì´í„° ì¡°íšŒ (ë·°ì–´ìš©)
@app.route('/api/meeting/<meeting_id>')
@login_required
def get_meeting_data(meeting_id):
    # ê¶Œí•œ ì²´í¬: can_access_meeting()
    # ë°˜í™˜: ì œëª©, ë‚ ì§œ, ëŒ€í™” ë‚´ìš©, ì˜¤ë””ì˜¤ URL, ì°¸ì„ì, í™”ì ì ìœ ìœ¨
```

**ë””ë²„ê¹… í¬ì¸íŠ¸**
```python
# ì˜¤ë¥˜ ì‹œ í™•ì¸í•  ê³³
1. ì—…ë¡œë“œ ì‹¤íŒ¨: app.py:334 - SSE yield ë¡œê·¸ í™•ì¸
2. ì±—ë´‡ ì˜¤ë¥˜: app.py:824 - accessible_meeting_ids í™•ì¸
3. ê¶Œí•œ ì˜¤ë¥˜: utils/user_manager.py:138 - can_access_meeting()
```

---

### 1.2 utils/stt.py (STT ë° AI ì²˜ë¦¬)

**ì—­í• :** Gemini APIë¥¼ ì‚¬ìš©í•œ STT, ìš”ì•½ ìƒì„±, íšŒì˜ë¡ ìƒì„±

**ì£¼ìš” í•¨ìˆ˜**

| í•¨ìˆ˜ëª… | ë¼ì¸ | íŒŒë¼ë¯¸í„° | ë°˜í™˜ê°’ | ì„¤ëª… |
|--------|------|----------|--------|------|
| `transcribe_audio()` | 20 | `audio_file_path` | `list[dict]` | Gemini 2.5 Pro STT + í™”ì ë¶„ë¦¬ |
| `generate_summary_from_chunks()` | 152 | `meeting_id, vdb_manager` | `str` | ChromaDBì—ì„œ ì²­í¬ ì¡°íšŒ â†’ ë¬¸ë‹¨ ìš”ì•½ ìƒì„± |
| `generate_minutes_from_summary()` | 206 | `meeting_id, vdb_manager` | `str` | ë¬¸ë‹¨ ìš”ì•½ â†’ ì •ì‹ íšŒì˜ë¡ ë³€í™˜ |

**í•µì‹¬ ì½”ë“œ ë¸”ë¡**

```python
# ë¼ì¸ 20: STT í•¨ìˆ˜
def transcribe_audio(audio_file_path):
    """
    Gemini 2.5 Proë¡œ STT + í™”ì ë¶„ë¦¬

    ë°˜í™˜ í˜•ì‹:
    [
        {
            "speaker_label": "1",
            "start_time": 0.0,
            "segment": "ì•ˆë…•í•˜ì„¸ìš”. íšŒì˜ë¥¼ ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤."
        },
        ...
    ]
    """
    # 1. íŒŒì¼ ì—…ë¡œë“œ (Gemini File API)
    # 2. generate_content() í˜¸ì¶œ
    #    - íŒŒë¼ë¯¸í„°: enable_speaker_diarization=True
    # 3. ì‘ë‹µ íŒŒì‹±: utterances ì¶”ì¶œ
```

```python
# ë¼ì¸ 152: ë¬¸ë‹¨ ìš”ì•½ ìƒì„±
def generate_summary_from_chunks(meeting_id, vdb_manager):
    """
    ChromaDB ì²­í¬ â†’ ì£¼ì œë³„ ìš”ì•½

    í”„ë¡¬í”„íŠ¸:
    "ë‹¤ìŒ íšŒì˜ ëŒ€í™”ë¥¼ ì£¼ì œë³„ë¡œ ë‚˜ëˆ„ì–´ ìš”ì•½í•´ì£¼ì„¸ìš”.
     ê° ì£¼ì œëŠ” '### ì£¼ì œëª…' í˜•ì‹ìœ¼ë¡œ ì‹œì‘..."
    """
    # 1. vdb_manager.get_chunks_by_meeting_id() - ì²­í¬ ì¡°íšŒ
    # 2. Gemini 2.5 Pro í˜¸ì¶œ
    # 3. ê²°ê³¼ íŒŒì‹±: "### " êµ¬ë¶„ìë¡œ ë¶„ë¦¬
```

**API ì„¤ì •**
```python
# ë¼ì¸ ìƒë‹¨
GOOGLE_API_KEY = os.getenv("GOOGLE_API_KEY")
client = genai.Client(api_key=GOOGLE_API_KEY)

# STT ëª¨ë¸
model = "models/gemini-2.0-flash-exp"

# ìš”ì•½ ëª¨ë¸
model = "gemini-2.5-pro"
```

**ë””ë²„ê¹… í¬ì¸íŠ¸**
```python
# STT ì˜¤ë¥˜ ì‹œ
1. API í‚¤ í™•ì¸: .env GOOGLE_API_KEY
2. íŒŒì¼ í¬ê¸°: Gemini ì œí•œ (ì•½ 2ì‹œê°„ ì˜¤ë””ì˜¤)
3. ì‘ë‹µ í˜•ì‹: utterances í•„ë“œ ì¡´ì¬ ì—¬ë¶€

# ìš”ì•½ ì˜¤ë¥˜ ì‹œ
1. ì²­í¬ ì¡°íšŒ ì‹¤íŒ¨: vdb_manager.get_chunks_by_meeting_id()
2. í”„ë¡¬í”„íŠ¸ í† í° ì´ˆê³¼: ì²­í¬ ê°œìˆ˜ í™•ì¸
```

---

### 1.3 utils/db_manager.py (SQLite ê´€ë¦¬)

**ì—­í• :** SQLite CRUD ì‘ì—… (meeting_dialogues, meeting_minutes)

**ì£¼ìš” í•¨ìˆ˜**

| í•¨ìˆ˜ëª… | ë¼ì¸ | íŒŒë¼ë¯¸í„° | ë°˜í™˜ê°’ | ì„¤ëª… |
|--------|------|----------|--------|------|
| `save_meeting_dialogue()` | 87 | `meeting_id, title, date, audio, segments, owner_id` | `dict` | STT ê²°ê³¼ ì €ì¥ |
| `get_dialogues_by_meeting_id()` | 135 | `meeting_id` | `list[dict]` | ëŒ€í™” ë‚´ìš© ì¡°íšŒ |
| `save_meeting_minutes()` | 187 | `meeting_id, title, date, summary, mindmap, owner_id` | `dict` | ìš”ì•½ + ë§ˆì¸ë“œë§µ ì €ì¥ |
| `delete_meeting_by_id()` | 243 | `meeting_id` | `dict` | SQLite ë°ì´í„° ì‚­ì œ (dialogues + minutes + shares) |
| `get_audio_file_by_meeting_id()` | 362 | `meeting_id` | `str` | ì˜¤ë””ì˜¤ íŒŒì¼ëª… ì¡°íšŒ |

**í•µì‹¬ ì½”ë“œ ë¸”ë¡**

```python
# ë¼ì¸ 87: STT ê²°ê³¼ ì €ì¥
def save_meeting_dialogue(...):
    """
    meeting_dialogues í…Œì´ë¸”ì— ì„¸ê·¸ë¨¼íŠ¸ ì‚½ì…
    """
    cursor.executemany("""
        INSERT INTO meeting_dialogues
        (meeting_id, owner_id, title, meeting_date, audio_file, speaker_label, start_time, segment)
        VALUES (?, ?, ?, ?, ?, ?, ?, ?)
    """, data_to_insert)
    # executemany: í•œ ë²ˆì— ì—¬ëŸ¬ í–‰ ì‚½ì… (ì„±ëŠ¥ í–¥ìƒ)
```

```python
# ë¼ì¸ 243: ë…¸íŠ¸ ì‚­ì œ (SQLiteë§Œ)
def delete_meeting_by_id(meeting_id):
    """
    3ê°œ í…Œì´ë¸” ì‚­ì œ:
    1. meeting_dialogues
    2. meeting_minutes
    3. meeting_shares
    """
    # ì‚­ì œ ì „í›„ ë¡œê·¸ ì¶œë ¥ (ê²€ì¦ìš©)
    # ë°˜í™˜: {dialogues: Nê°œ, minutes: Nê°œ, shares: Nê°œ}
```

**DB ê²½ë¡œ**
```python
DB_PATH = "database/minute_ai.db"
```

**ë””ë²„ê¹… í¬ì¸íŠ¸**
```python
# ì €ì¥ ì˜¤ë¥˜ ì‹œ
1. DB íŒŒì¼ ê¶Œí•œ í™•ì¸: ls -l database/minute_ai.db
2. owner_id NULL ì˜¤ë¥˜: session['user_id'] í™•ì¸
3. UNIQUE ì œì•½ ìœ„ë°˜: meeting_id ì¤‘ë³µ í™•ì¸

# ì¡°íšŒ ì˜¤ë¥˜ ì‹œ
1. meeting_id ì˜¤íƒ€ í™•ì¸
2. ì‚­ì œëœ ë°ì´í„°: meeting_dialogues í…Œì´ë¸” ì§ì ‘ ì¡°íšŒ
```

---

### 1.4 utils/vector_db_manager.py (ChromaDB ê´€ë¦¬)

**ì—­í• :** ChromaDB ë²¡í„° DB ê´€ë¦¬ (ì²­í‚¹, ì„ë² ë”©, ê²€ìƒ‰)

**ì£¼ìš” í•¨ìˆ˜**

| í•¨ìˆ˜ëª… | ë¼ì¸ | íŒŒë¼ë¯¸í„° | ë°˜í™˜ê°’ | ì„¤ëª… |
|--------|------|----------|--------|------|
| `add_meeting_as_chunk()` | 116 | `meeting_id, title, date, audio, segments` | `None` | ìŠ¤ë§ˆíŠ¸ ì²­í‚¹ + ChromaDB ì €ì¥ |
| `_create_smart_chunks()` | 230 | `segments, max_size, time_gap` | `list[dict]` | í™”ì/ì‹œê°„ ê¸°ë°˜ ì²­í‚¹ |
| `_clean_text()` | 95 | `formatted_text` | `str` | ì •ê·œì‹ìœ¼ë¡œ ë©”íƒ€ë°ì´í„° ì œê±° |
| `add_meeting_as_subtopic()` | 311 | `meeting_id, title, date, audio, summary` | `list` | ë¬¸ë‹¨ ìš”ì•½ ChromaDB ì €ì¥ |
| `search()` | 368 | `db_type, query, k, retriever_type` | `list` | ë²¡í„° ê²€ìƒ‰ (similarity/mmr/self_query) |
| `delete_from_collection()` | 586 | `db_type, meeting_id` | `None` | ChromaDB ë°ì´í„° ì‚­ì œ |
| `_delete_all_meeting_data()` | 658 | `meeting_id` | `dict` | SQLite + ChromaDB + íŒŒì¼ ëª¨ë‘ ì‚­ì œ |
| `get_chunks_by_meeting_id()` | 486 | `meeting_id` | `str` | ì²­í¬ ì¡°íšŒ (chunk_index ìˆœì„œ) |
| `update_metadata_title()` | 857 | `meeting_id, new_title` | `dict` | ChromaDB ë©”íƒ€ë°ì´í„° ì œëª© ìˆ˜ì • |

**í•µì‹¬ ì½”ë“œ ë¸”ë¡**

```python
# ë¼ì¸ 230: ìŠ¤ë§ˆíŠ¸ ì²­í‚¹
def _create_smart_chunks(segments, max_chunk_size=1000, time_gap_threshold=60):
    """
    ì²­í‚¹ ê¸°ì¤€:
    1. í¬ê¸°: 1000ì ì´ˆê³¼
    2. ì‹œê°„ ê°„ê²©: 60ì´ˆ ì´ìƒ ì¹¨ë¬µ
    3. í™”ì ë³€ê²½: 500ì ì´ìƒ + í™”ì ë³€ê²½
    """
    # ë°˜ë³µë¬¸ìœ¼ë¡œ ì„¸ê·¸ë¨¼íŠ¸ ìˆœíšŒ
    # should_split í”Œë˜ê·¸ë¡œ ë¶„ë¦¬ ì¡°ê±´ ì²´í¬
    # ë°˜í™˜: [{'text': str, 'start_time': float, 'end_time': float, 'speaker_count': int}]
```

```python
# ë¼ì¸ 95: ë©”íƒ€ë°ì´í„° ì •ì œ
def _clean_text(formatted_text):
    """
    ì •ê·œì‹ìœ¼ë¡œ [Speaker X, MM:SS] ì œê±°

    ì…ë ¥: "[Speaker 1, 02:15] ì•ˆë…•í•˜ì„¸ìš”.\n[Speaker 2, 02:30] ë°˜ê°‘ìŠµë‹ˆë‹¤."
    ì¶œë ¥: "ì•ˆë…•í•˜ì„¸ìš”.\në°˜ê°‘ìŠµë‹ˆë‹¤."
    """
    pattern = r'\[Speaker [^,]+, \d{2}:\d{2}\]\s*'
    cleaned_text = re.sub(pattern, '', formatted_text)
    return cleaned_text.strip()
```

```python
# ë¼ì¸ 368: ë²¡í„° ê²€ìƒ‰
def search(db_type, query, k=5, retriever_type="similarity", ...):
    """
    ChromaDB ê²€ìƒ‰

    db_type: "chunks" or "subtopic"
    retriever_type: "similarity" (ê¸°ë³¸), "mmr", "self_query"
    """
    # 2025-11-08: self_query â†’ similarity ë³€ê²½ (ì„±ëŠ¥ í–¥ìƒ)
    # similarity_search: ì½”ì‚¬ì¸ ìœ ì‚¬ë„ë¡œ ìƒìœ„ kê°œ ë°˜í™˜
```

```python
# ë¼ì¸ 658: ì „ì²´ ì‚­ì œ (SQLite + ChromaDB + íŒŒì¼)
def _delete_all_meeting_data(meeting_id):
    """
    ì‚­ì œ í”„ë¡œì„¸ìŠ¤:
    1. SQLite: meeting_dialogues, meeting_minutes, meeting_shares
    2. ChromaDB: meeting_chunks, meeting_subtopic
    3. íŒŒì¼: uploads/{audio_file}

    ëª¨ë“  ë‹¨ê³„ë§ˆë‹¤ ì‚­ì œ ì „/í›„ ë¡œê·¸ ì¶œë ¥ (ê²€ì¦ìš©)
    """
```

**ChromaDB ì»¬ë ‰ì…˜**
```python
COLLECTION_NAMES = {
    'chunks': 'meeting_chunks',      # ëŒ€í™” ì²­í‚¹
    'subtopic': 'meeting_subtopic',  # ë¬¸ë‹¨ ìš”ì•½
}
```

**ë””ë²„ê¹… í¬ì¸íŠ¸**
```python
# ì²­í‚¹ ì˜¤ë¥˜ ì‹œ
1. segments í˜•ì‹ í™•ì¸: [{'speaker_label', 'start_time', 'segment'}]
2. ì •ê·œì‹ ì˜¤ë¥˜: _clean_text() í…ŒìŠ¤íŠ¸

# ê²€ìƒ‰ ì˜¤ë¥˜ ì‹œ
1. ì»¬ë ‰ì…˜ ì—†ìŒ: ChromaDB íŒŒì¼ í™•ì¸
2. ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ: meeting_id í•„í„° í™•ì¸

# ì‚­ì œ ì˜¤ë¥˜ ì‹œ
1. ë¡œê·¸ í™•ì¸: "ì‚­ì œ ì „ Nê°œ â†’ ì‚­ì œ í›„ 0ê°œ"
2. íŒŒì¼ ê¶Œí•œ: uploads/ í´ë” ì“°ê¸° ê¶Œí•œ
```

---

### 1.5 utils/chat_manager.py (RAG ì±—ë´‡)

**ì—­í• :** ë²¡í„° ê²€ìƒ‰ + AI ë‹µë³€ ìƒì„±

**ì£¼ìš” í•¨ìˆ˜**

| í•¨ìˆ˜ëª… | ë¼ì¸ | íŒŒë¼ë¯¸í„° | ë°˜í™˜ê°’ | ì„¤ëª… |
|--------|------|----------|--------|------|
| `process_query()` | 319 | `query, meeting_id, accessible_meeting_ids` | `dict` | ì§ˆì˜ â†’ ê²€ìƒ‰ â†’ ë‹µë³€ (ì „ì²´ í”„ë¡œì„¸ìŠ¤) |
| `search_documents()` | 39 | `query, meeting_id, accessible_meeting_ids` | `dict` | chunks 3ê°œ + subtopic 3ê°œ ê²€ìƒ‰ |
| `format_context()` | 206 | `search_results` | `str` | ê²€ìƒ‰ ê²°ê³¼ â†’ í”„ë¡¬í”„íŠ¸ìš© í…ìŠ¤íŠ¸ |
| `generate_answer()` | 254 | `query, context` | `dict` | Gemini 2.5 Flash ë‹µë³€ ìƒì„± |

**í•µì‹¬ ì½”ë“œ ë¸”ë¡**

```python
# ë¼ì¸ 319: ì „ì²´ ì§ˆì˜ í”„ë¡œì„¸ìŠ¤
def process_query(query, meeting_id=None, accessible_meeting_ids=None):
    """
    1. ë¬¸ì„œ ê²€ìƒ‰ (chunks 3ê°œ + subtopic 3ê°œ)
    2. ì»¨í…ìŠ¤íŠ¸ í¬ë§·íŒ…
    3. AI ë‹µë³€ ìƒì„±
    4. ì¶œì²˜ ì •ë³´ ì¶”ê°€
    """
    # ê¶Œí•œ ì²´í¬: accessible_meeting_idsë¡œ í•„í„°ë§
    # ë°˜í™˜: {success, answer, sources}
```

```python
# ë¼ì¸ 39: ë¬¸ì„œ ê²€ìƒ‰
def search_documents(query, meeting_id, accessible_meeting_ids):
    """
    2025-11-08 ê°œì„ :
    - SelfQuery ì œê±° (LLM í˜¸ì¶œ ë¶ˆí•„ìš”)
    - Similarity Search ì§ì ‘ ì‚¬ìš©
    - title í‚¤ì›Œë“œ í•„í„°ë§ ë¹„í™œì„±í™” (ì˜¤íˆë ¤ ì¢‹ì€ ê²°ê³¼ ì œê±°)
    """
    # chunks: k=3
    # subtopic: k=3
    # ì´ 6ê°œ ë¬¸ì„œ ë°˜í™˜
```

```python
# ë¼ì¸ 206: ì»¨í…ìŠ¤íŠ¸ í¬ë§·íŒ…
def format_context(search_results):
    """
    ë©”íƒ€ë°ì´í„° ìš°ì„  ì›ì¹™:
    - ì œëª©: metadata['title'] (êµ¬ë²„ì „ ë³¸ë¬¸ ì œëª© ë¬´ì‹œ)
    - ë‚ ì§œ: metadata['meeting_date']

    í˜•ì‹:
    === íšŒì˜ ëŒ€í™” ë‚´ìš© ===
    [ë¬¸ì„œ 1]
    íšŒì˜: {title}
    ì¼ì‹œ: {meeting_date}
    ì‹œê°„: {start_time}ì´ˆ - {end_time}ì´ˆ
    ë‚´ìš©: {page_content}
    """
```

```python
# ë¼ì¸ 254: AI ë‹µë³€ ìƒì„±
def generate_answer(query, context):
    """
    Gemini 2.5 Flash ì‚¬ìš©

    í”„ë¡¬í”„íŠ¸ í•µì‹¬:
    1. "ê²€ìƒ‰ëœ íšŒì˜ë¡ ì•ˆì—ì„œë§Œ ë‹µë³€"
    2. "ì—†ìœ¼ë©´ 'ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤' ëª…ì‹œ"
    3. "ì‚¬ì „ ì§€ì‹ ì‚¬ìš© ê¸ˆì§€" (í• ë£¨ì‹œë„¤ì´ì…˜ ë°©ì§€)
    4. "ë©”íƒ€ë°ì´í„° ìš°ì„ " (êµ¬ë²„ì „ ì œëª© ë¬´ì‹œ)
    """
```

**ì„±ëŠ¥ ì§€í‘œ**
```python
# 2025-11-08 í…ŒìŠ¤íŠ¸ ê²°ê³¼
- 20ê°œ ì§ˆë¬¸
- ì„±ê³µë¥ : 100% (20/20)
- í‰ê·  ì‘ë‹µ ì‹œê°„: 3.77ì´ˆ
```

**ë””ë²„ê¹… í¬ì¸íŠ¸**
```python
# ê²€ìƒ‰ ê²°ê³¼ ì—†ìŒ
1. accessible_meeting_ids í™•ì¸
2. ChromaDB ì»¬ë ‰ì…˜ ë°ì´í„° í™•ì¸

# ë‹µë³€ ì˜¤ë¥˜
1. ì»¨í…ìŠ¤íŠ¸ ê¸¸ì´: í† í° ì œí•œ í™•ì¸
2. í”„ë¡¬í”„íŠ¸ ê²€ì¦: format_context() ê²°ê³¼ í™•ì¸
```

---

### 1.6 utils/firebase_auth.py (Firebase ì¸ì¦)

**ì—­í• :** Firebase Admin SDK ì´ˆê¸°í™” ë° í† í° ê²€ì¦

**ì£¼ìš” í•¨ìˆ˜**

| í•¨ìˆ˜ëª… | ë¼ì¸ | íŒŒë¼ë¯¸í„° | ë°˜í™˜ê°’ | ì„¤ëª… |
|--------|------|----------|--------|------|
| `initialize_firebase()` | 15 | ì—†ìŒ | `None` | Firebase Admin SDK ì´ˆê¸°í™” (1íšŒë§Œ) |
| `verify_id_token()` | 43 | `id_token` | `dict or None` | ID í† í° ê²€ì¦ â†’ ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ |
| `get_user_by_uid()` | 84 | `uid` | `dict or None` | Firebase UIDë¡œ ì‚¬ìš©ì ì¡°íšŒ |

**í•µì‹¬ ì½”ë“œ ë¸”ë¡**

```python
# ë¼ì¸ 15: Firebase ì´ˆê¸°í™”
def initialize_firebase():
    """
    firebase-adminsdk.json íŒŒì¼ ì½ê¸°
    ì „ì—­ ë³€ìˆ˜ _firebase_initializedë¡œ ì¤‘ë³µ ì´ˆê¸°í™” ë°©ì§€
    """
    cred_path = os.path.join(os.path.dirname(os.path.dirname(__file__)),
                             'firebase-adminsdk.json')
    cred = credentials.Certificate(cred_path)
    firebase_admin.initialize_app(cred)
```

```python
# ë¼ì¸ 43: í† í° ê²€ì¦
def verify_id_token(id_token):
    """
    ë°˜í™˜ í˜•ì‹:
    {
        'uid': 'firebase_user_123',
        'email': 'user@example.com',
        'name': 'í™ê¸¸ë™',
        'picture': 'https://...'
    }

    ì˜ˆì™¸ ì²˜ë¦¬:
    - InvalidIdTokenError: ìœ„ì¡°ëœ í† í°
    - ExpiredIdTokenError: ë§Œë£Œëœ í† í°
    """
```

**ë””ë²„ê¹… í¬ì¸íŠ¸**
```python
# ì´ˆê¸°í™” ì˜¤ë¥˜
1. firebase-adminsdk.json íŒŒì¼ ì¡´ì¬ í™•ì¸
2. íŒŒì¼ ê¶Œí•œ: chmod 600 firebase-adminsdk.json

# í† í° ê²€ì¦ ì˜¤ë¥˜
1. í”„ë¡ íŠ¸ì—”ë“œ ID Token ì¬ë°œê¸‰
2. ì‹œê°„ ë™ê¸°í™”: NTP ì„œë²„ í™•ì¸
```

---

### 1.7 utils/user_manager.py (ì‚¬ìš©ì/ê¶Œí•œ ê´€ë¦¬)

**ì—­í• :** users í…Œì´ë¸” CRUD, ê¶Œí•œ ì²´í¬, ë…¸íŠ¸ ê³µìœ 

**ì£¼ìš” í•¨ìˆ˜**

| í•¨ìˆ˜ëª… | ë¼ì¸ | íŒŒë¼ë¯¸í„° | ë°˜í™˜ê°’ | ì„¤ëª… |
|--------|------|----------|--------|------|
| `get_or_create_user()` | 25 | `google_id, email, name, picture` | `dict` | ì‚¬ìš©ì ì¡°íšŒ/ìƒì„± |
| `is_admin()` | 132 | `user_id` | `bool` | Admin ê¶Œí•œ í™•ì¸ |
| `can_access_meeting()` | 138 | `user_id, meeting_id` | `bool` | ë…¸íŠ¸ ì ‘ê·¼ ê¶Œí•œ í™•ì¸ |
| `can_edit_meeting()` | 444 | `user_id, meeting_id` | `bool` | ë…¸íŠ¸ ìˆ˜ì • ê¶Œí•œ í™•ì¸ |
| `get_user_meetings()` | 181 | `user_id` | `list[dict]` | ë³¸ì¸ ë…¸íŠ¸ ëª©ë¡ |
| `get_shared_meetings()` | 234 | `user_id` | `list[dict]` | ê³µìœ ë°›ì€ ë…¸íŠ¸ ëª©ë¡ |
| `share_meeting()` | 276 | `meeting_id, owner_id, email` | `dict` | ë…¸íŠ¸ ê³µìœ  ìƒì„± |
| `get_user_accessible_meeting_ids()` | 401 | `user_id` | `list[str]` | ì ‘ê·¼ ê°€ëŠ¥í•œ ëª¨ë“  meeting_id |

**í•µì‹¬ ì½”ë“œ ë¸”ë¡**

```python
# ë¼ì¸ 25: ì‚¬ìš©ì ì¡°íšŒ/ìƒì„±
def get_or_create_user(google_id, email, name, profile_picture):
    """
    1. google_idë¡œ ì¡°íšŒ â†’ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸
    2. emailë¡œ ì¡°íšŒ (migrate ì‹œ ë”ë¯¸ ê³„ì •) â†’ google_id ê°±ì‹ 
    3. ì—†ìœ¼ë©´ ì‹ ê·œ ìƒì„±
       - role: .env ADMIN_EMAILSì— ìˆìœ¼ë©´ 'admin', ì•„ë‹ˆë©´ 'user'
    """
```

```python
# ë¼ì¸ 138: ë…¸íŠ¸ ì ‘ê·¼ ê¶Œí•œ í™•ì¸
def can_access_meeting(user_id, meeting_id):
    """
    ì¡°ê±´ (OR):
    1. Admin ê¶Œí•œ
    2. ë³¸ì¸ì´ ìƒì„±í•œ ë…¸íŠ¸ (meeting_dialogues.owner_id)
    3. ê³µìœ ë°›ì€ ë…¸íŠ¸ (meeting_shares í…Œì´ë¸”)
    """
```

```python
# ë¼ì¸ 444: ë…¸íŠ¸ ìˆ˜ì • ê¶Œí•œ í™•ì¸
def can_edit_meeting(user_id, meeting_id):
    """
    ì¡°ê±´ (OR):
    1. Admin ê¶Œí•œ
    2. ë³¸ì¸ì´ ìƒì„±í•œ ë…¸íŠ¸ (owner_id == user_id)

    ê³µìœ ë°›ì€ ì‚¬ëŒì€ ìˆ˜ì • ë¶ˆê°€ (ì½ê¸°ë§Œ ê°€ëŠ¥)
    """
```

```python
# ë¼ì¸ 276: ë…¸íŠ¸ ê³µìœ 
def share_meeting(meeting_id, owner_id, shared_with_email):
    """
    ê²€ì¦:
    1. shared_with_email ì‚¬ìš©ì ì¡´ì¬?
    2. ë³¸ì¸ì—ê²Œ ê³µìœ  ë°©ì§€
    3. owner_id == meeting_dialogues.owner_id?
    4. ì´ë¯¸ ê³µìœ ë˜ì–´ ìˆëŠ”ì§€?

    meeting_shares í…Œì´ë¸”ì— ì‚½ì…
    permission: 'read' (í˜„ì¬ ì½ê¸°ë§Œ ì§€ì›)
    """
```

**ë””ë²„ê¹… í¬ì¸íŠ¸**
```python
# ê¶Œí•œ ì˜¤ë¥˜
1. session['user_id'] í™•ì¸
2. users í…Œì´ë¸”ì—ì„œ role í™•ì¸
3. meeting_dialogues.owner_id ì¼ì¹˜ ì—¬ë¶€

# ê³µìœ  ì˜¤ë¥˜
1. ê³µìœ ë°›ì„ ì‚¬ìš©ì ì´ë©”ì¼ ì˜¤íƒ€
2. meeting_shares UNIQUE ì œì•½ ìœ„ë°˜ (ì´ë¯¸ ê³µìœ ë¨)
```

---

### 1.8 utils/decorators.py (ì¸ì¦ ë°ì½”ë ˆì´í„°)

**ì—­í• :** Flask ë¼ìš°íŠ¸ ì¸ì¦ ë°ì½”ë ˆì´í„°

**ì£¼ìš” ë°ì½”ë ˆì´í„°**

| ë°ì½”ë ˆì´í„° | ë¼ì¸ | ì„¤ëª… | ë¦¬ë‹¤ì´ë ‰íŠ¸ |
|-----------|------|------|----------|
| `@login_required` | 12 | ë¡œê·¸ì¸ í•„ìˆ˜ | `/login` |
| `@admin_required` | 38 | Admin ê¶Œí•œ í•„ìˆ˜ | 403 Forbidden |
| `@optional_login` | 74 | ë¡œê·¸ì¸ ì„ íƒì  | ì—†ìŒ |

**í•µì‹¬ ì½”ë“œ ë¸”ë¡**

```python
# ë¼ì¸ 12: @login_required
@wraps(f)
def decorated_function(*args, **kwargs):
    if 'user_id' not in session:
        # API ìš”ì²­: JSON ì‘ë‹µ
        if request.path.startswith('/api/'):
            return jsonify({'error': 'ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.'}), 401
        # í˜ì´ì§€ ìš”ì²­: ë¦¬ë‹¤ì´ë ‰íŠ¸
        return redirect(url_for('login_page'))
    return f(*args, **kwargs)
```

**ì‚¬ìš© ì˜ˆì‹œ**
```python
@app.route('/notes')
@login_required
def list_notes():
    # session['user_id']ê°€ ìˆì–´ì•¼ë§Œ ì‹¤í–‰ë¨
```

---

### 1.9 utils/analysis.py (í™”ì ë¶„ì„)

**ì—­í• :** í™”ìë³„ ë°œì–¸ ì ìœ ìœ¨ ê³„ì‚°

**ì£¼ìš” í•¨ìˆ˜**

| í•¨ìˆ˜ëª… | ë¼ì¸ | íŒŒë¼ë¯¸í„° | ë°˜í™˜ê°’ | ì„¤ëª… |
|--------|------|----------|--------|------|
| `calculate_speaker_share()` | 8 | `meeting_id` | `dict` | í™”ìë³„ ì ìœ ìœ¨ (%) ê³„ì‚° |

**í•µì‹¬ ì½”ë“œ ë¸”ë¡**

```python
# ë¼ì¸ 8: í™”ìë³„ ì ìœ ìœ¨ ê³„ì‚°
def calculate_speaker_share(meeting_id):
    """
    ê¸€ì ìˆ˜ ê¸°ë°˜ ì ìœ ìœ¨

    ë°˜í™˜ í˜•ì‹:
    {
        "labels": ["Speaker 1", "Speaker 2"],
        "data": [65.3, 34.7]
    }
    """
    # 1. meeting_dialoguesì—ì„œ ì„¸ê·¸ë¨¼íŠ¸ ì¡°íšŒ
    # 2. í™”ìë³„ ê¸€ì ìˆ˜ í•©ì‚°
    # 3. ë¹„ìœ¨ ê³„ì‚°: (í™”ì ê¸€ì ìˆ˜ / ì „ì²´ ê¸€ì ìˆ˜) * 100
```

---

### 1.10 utils/validation.py (ì…ë ¥ ê²€ì¦)

**ì—­í• :** ì‚¬ìš©ì ì…ë ¥ê°’ ê²€ì¦ ë° ë‚ ì§œ ì²˜ë¦¬

**ì£¼ìš” í•¨ìˆ˜**

| í•¨ìˆ˜ëª… | ë¼ì¸ | íŒŒë¼ë¯¸í„° | ë°˜í™˜ê°’ | ì„¤ëª… |
|--------|------|----------|--------|------|
| `validate_title()` | 7 | `title` | `(bool, str)` | ì œëª© ê²€ì¦ |
| `get_current_datetime_string()` | 24 | ì—†ìŒ | `str` | í˜„ì¬ ì‹œê°„ ë¬¸ìì—´ |
| `parse_meeting_date()` | 34 | `meeting_date` | `str` | ë‚ ì§œ íŒŒì‹± (ë¹ˆ ê°’ â†’ í˜„ì¬ ì‹œê°„) |

**í•µì‹¬ ì½”ë“œ ë¸”ë¡**

```python
# ë¼ì¸ 34: ë‚ ì§œ íŒŒì‹±
def parse_meeting_date(meeting_date):
    """
    ì…ë ¥: "2025-11-07T14:30" (datetime-local í˜•ì‹)
    ì¶œë ¥: "2025-11-07 14:30:00" (DB í˜•ì‹)

    ë¹ˆ ê°’ â†’ í˜„ì¬ ì‹œê°„
    """
```

---

## 2. Frontend í•µì‹¬ íŒŒì¼

### 2.1 static/js/script.js (ë©”ì¸ ìŠ¤í¬ë¦½íŠ¸)

**ì—­í• :** ì±—ë´‡, ì—…ë¡œë“œ, SSE ì²˜ë¦¬

**ì£¼ìš” ê¸°ëŠ¥**

| ê¸°ëŠ¥ | ë¼ì¸ | ì„¤ëª… |
|------|------|------|
| ì±—ë´‡ í† ê¸€ | 24 | ì‚¬ì´ë“œë°” ì—´ê¸°/ë‹«ê¸° |
| ì±—ë´‡ ìƒíƒœ ë³µì› | 56 | sessionStorageì—ì„œ ì—´ë¦¼/ë‹«í˜ ìƒíƒœ ë³µì› |
| ì±—ë´‡ ëŒ€í™” ë‚´ì—­ | 204 | sessionStorageì— ìµœê·¼ 50ê°œ ë©”ì‹œì§€ ì €ì¥ |
| ì±—ë´‡ ë©”ì‹œì§€ ì „ì†¡ | 116 | `/api/chat` POST ìš”ì²­ |
| íŒŒì¼ ì—…ë¡œë“œ | 310 | ë“œë˜ê·¸ì•¤ë“œë¡­ + íŒŒì¼ ì„ íƒ |
| SSE ì§„í–‰ ìƒíƒœ | 405 | ì‹¤ì‹œê°„ ì—…ë¡œë“œ ì§„í–‰ ìƒíƒœ ìˆ˜ì‹  |
| ì¤‘ë³µ ì—…ë¡œë“œ ë°©ì§€ | 421 | sessionStorage + `/api/check_duplicate` |

**í•µì‹¬ ì½”ë“œ ë¸”ë¡**

```javascript
// ë¼ì¸ 56: ì±—ë´‡ ìƒíƒœ ë³µì›
function restoreChatbotState() {
    const savedState = sessionStorage.getItem(CHATBOT_STATE_KEY);

    // ê¸°ë³¸ê°’: ì—´ë¦¼ (ëª…ì‹œì ìœ¼ë¡œ 'closed'ê°€ ì•„ë‹ˆë©´)
    if (savedState !== 'closed') {
        // transition ë¹„í™œì„±í™” (ì• ë‹ˆë©”ì´ì…˜ ë°©ì§€)
        chatbotSidebar.classList.add('no-transition');
        // ì±—ë´‡ ì—´ê¸°
        chatbotSidebar.classList.add('open');
        // transition ì¬í™œì„±í™”
        requestAnimationFrame(() => { ... });
    }
}
```

```javascript
// ë¼ì¸ 204: ëŒ€í™” ë‚´ì—­ ë¶ˆëŸ¬ì˜¤ê¸°
function loadChatHistory() {
    const historyJson = sessionStorage.getItem(CHAT_HISTORY_KEY);
    const history = JSON.parse(historyJson);

    // ì €ì¥ëœ ë©”ì‹œì§€ í™”ë©´ì— í‘œì‹œ
    history.messages.forEach(msg => {
        // msg.role: 'user' or 'assistant'
        // msg.content: ë©”ì‹œì§€ í…ìŠ¤íŠ¸
        // msg.isSource: ì¶œì²˜ ì •ë³´ ì—¬ë¶€
    });
}
```

```javascript
// ë¼ì¸ 405: SSE ì—…ë¡œë“œ ì²˜ë¦¬
uploadForm.addEventListener('submit', async (event) => {
    event.preventDefault();

    // FormData ìƒì„±
    const formData = new FormData(uploadForm);

    // fetchë¡œ SSE ìˆ˜ì‹ 
    const response = await fetch(uploadForm.action, {
        method: 'POST',
        body: formData
    });

    // ReadableStreamìœ¼ë¡œ ì‹¤ì‹œê°„ ë°ì´í„° ì½ê¸°
    const reader = response.body.getReader();
    const decoder = new TextDecoder();

    while (true) {
        const { value, done } = await reader.read();
        if (done) break;

        // "data: {...}\n\n" í˜•ì‹ íŒŒì‹±
        if (line.startsWith('data: ')) {
            const data = JSON.parse(line.substring(6));
            handleSSEMessage(data);
        }
    }
});
```

```javascript
// ë¼ì¸ 421: ì¤‘ë³µ ì—…ë¡œë“œ ë°©ì§€
sessionStorage.setItem('upload_in_progress', 'true');
sessionStorage.setItem('upload_start_time', Date.now().toString());

// í˜ì´ì§€ ë¡œë“œ ì‹œ í™•ì¸ (DOMContentLoaded)
function checkUploadStatus() {
    const inProgress = sessionStorage.getItem('upload_in_progress');
    const startTime = sessionStorage.getItem('upload_start_time');

    if (inProgress === 'true') {
        const elapsed = Date.now() - parseInt(startTime);
        if (elapsed < 10 * 60 * 1000) {  // 10ë¶„ ì´ë‚´
            alert('ì—…ë¡œë“œê°€ ì´ë¯¸ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.');
        }
    }
}
```

---

### 2.2 static/js/viewer.js (íšŒì˜ë¡ ë·°ì–´)

**ì—­í• :** ì˜¤ë””ì˜¤/ë¹„ë””ì˜¤ í”Œë ˆì´ì–´, íƒ­ ì „í™˜, ì¸ë¼ì¸ í¸ì§‘

**ì£¼ìš” ê¸°ëŠ¥**

| ê¸°ëŠ¥ | ë¼ì¸ | ì„¤ëª… |
|------|------|------|
| ë·°ì–´ ì´ˆê¸°í™” | 45 | `/api/meeting/{meeting_id}` ë°ì´í„° ì¡°íšŒ |
| ì˜¤ë””ì˜¤/ë¹„ë””ì˜¤ ì„ íƒ | 79 | íŒŒì¼ í™•ì¥ìë¡œ í”Œë ˆì´ì–´ ìë™ ì„ íƒ |
| ì„¸ê·¸ë¨¼íŠ¸ ë Œë”ë§ | 167 | ëŒ€í™” ë‚´ìš© ë¸”ë¡ ìƒì„± + í´ë¦­ ì‹œ ì¬ìƒ |
| íƒ€ì„ ì‹±í¬ | 202 | ì¬ìƒ ì‹œê°„ì— ë§ì¶° ì„¸ê·¸ë¨¼íŠ¸ í•˜ì´ë¼ì´íŠ¸ |
| íƒ­ ì „í™˜ | 26 | ëŒ€í™”/ìš”ì•½/íšŒì˜ë¡ íƒ­ |
| ì œëª© ì¸ë¼ì¸ í¸ì§‘ | - | ì—°í•„ ë²„íŠ¼ â†’ ìˆ˜ì • â†’ `/api/update_title` |
| ë‚ ì§œ ì¸ë¼ì¸ í¸ì§‘ | - | ì—°í•„ ë²„íŠ¼ â†’ ìˆ˜ì • â†’ `/api/update_date` |
| ë³µì‚¬ ë²„íŠ¼ | - | ë¬¸ë‹¨ ìš”ì•½/íšŒì˜ë¡ ë³µì‚¬ |

**í•µì‹¬ ì½”ë“œ ë¸”ë¡**

```javascript
// ë¼ì¸ 79: ì˜¤ë””ì˜¤/ë¹„ë””ì˜¤ í”Œë ˆì´ì–´ ì„ íƒ
const fileExtension = audioUrl.split('.').pop().toLowerCase();

if (fileExtension === 'mp4') {
    // ë¹„ë””ì˜¤ í”Œë ˆì´ì–´
    videoPlayer.src = audioUrl;
    videoPlayer.style.display = 'block';
    audioPlayer.style.display = 'none';
    currentPlayer = videoPlayer;
} else {
    // ì˜¤ë””ì˜¤ í”Œë ˆì´ì–´
    audioPlayer.src = audioUrl;
    audioPlayer.style.display = 'block';
    videoPlayer.style.display = 'none';
    currentPlayer = audioPlayer;
}
```

```javascript
// ë¼ì¸ 202: íƒ€ì„ ì‹±í¬
player.addEventListener('timeupdate', () => {
    const currentTime = player.currentTime;

    // í˜„ì¬ ì‹œê°„ì— í•´ë‹¹í•˜ëŠ” ì„¸ê·¸ë¨¼íŠ¸ ì°¾ê¸°
    for (let i = 0; i < segments.length; i++) {
        const startTime = segments[i].start_time;
        const endTime = segments[i + 1] ? segments[i + 1].start_time : player.duration;

        if (currentTime >= startTime && currentTime < endTime) {
            highlightSegment(i);
            break;
        }
    }
});
```

---

### 2.3 templates/layout.html (ì „ì—­ ë ˆì´ì•„ì›ƒ)

**ì—­í• :** ë„¤ë¹„ê²Œì´ì…˜, ì±—ë´‡ ì‚¬ì´ë“œë°”, ë¡œê·¸ì•„ì›ƒ

**ì£¼ìš” êµ¬ì„± ìš”ì†Œ**

| ìš”ì†Œ | ë¼ì¸ | ì„¤ëª… |
|------|------|------|
| ë„¤ë¹„ê²Œì´ì…˜ | 13 | ì™¼ìª½ ì‚¬ì´ë“œë°” ë©”ë‰´ |
| ì‚¬ìš©ì ì •ë³´ ì¹´ë“œ | 42 | í”„ë¡œí•„ ì‚¬ì§„ + ì´ë¦„ + ì´ë©”ì¼ |
| ì±—ë´‡ ì‚¬ì´ë“œë°” | 73 | ìš°ì¸¡ ì±—ë´‡ UI |
| ì±—ë´‡ í† ê¸€ íƒ­ | 67 | ì±—ë´‡ ë‹«í˜ ì‹œ ë³´ì´ëŠ” íƒ­ |
| ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ | 133 | `/api/logout` POST |

---

### 2.4 templates/index.html (ì—…ë¡œë“œ í˜ì´ì§€)

**ì—­í• :** íŒŒì¼ ì—…ë¡œë“œ UI, í”„ë¡œê·¸ë ˆìŠ¤ ëª¨ë‹¬

**ì£¼ìš” êµ¬ì„± ìš”ì†Œ**

| ìš”ì†Œ | ë¼ì¸ | ì„¤ëª… |
|------|------|------|
| ì œëª© ì…ë ¥ | 9 | `<input name="title">` |
| ë“œë¡­ì¡´ | 16 | ë“œë˜ê·¸ì•¤ë“œë¡­ ì˜ì—­ |
| íŒŒì¼ ì„ íƒ ë²„íŠ¼ | 20 | `<button id="upload-button">` |
| ë…¸íŠ¸ ìƒì„± ë²„íŠ¼ | 24 | `<button type="submit">` (íŒŒì¼ ì„ íƒ í›„ ë³´ì„) |
| í”„ë¡œê·¸ë ˆìŠ¤ ëª¨ë‹¬ | 29 | 4ë‹¨ê³„ ì§„í–‰ ìƒíƒœ (ì—…ë¡œë“œ â†’ STT â†’ ìš”ì•½ â†’ ë§ˆì¸ë“œë§µ) |

---

### 2.5 static/css/style.css (ìŠ¤íƒ€ì¼)

**ì—­í• :** Blue Gradient í…Œë§ˆ, ë°˜ì‘í˜• ë””ìì¸

**ì£¼ìš” ìŠ¤íƒ€ì¼**

| í´ë˜ìŠ¤ | ì„¤ëª… |
|--------|------|
| `.main-nav` | ì™¼ìª½ ë„¤ë¹„ê²Œì´ì…˜ (Blue Gradient) |
| `.chatbot-sidebar` | ìš°ì¸¡ ì±—ë´‡ ì‚¬ì´ë“œë°” |
| `.chat-message.user` | ì‚¬ìš©ì ë©”ì‹œì§€ (ì˜¤ë¥¸ìª½, íŒŒë€ìƒ‰) |
| `.chat-message.assistant` | AI ë©”ì‹œì§€ (ì™¼ìª½, íšŒìƒ‰) |
| `.segment-block.current` | í˜„ì¬ ì¬ìƒ ì¤‘ ì„¸ê·¸ë¨¼íŠ¸ (í•˜ì´ë¼ì´íŠ¸) |
| `.progress-modal` | í”„ë¡œê·¸ë ˆìŠ¤ ëª¨ë‹¬ (ì¤‘ì•™ ì •ë ¬) |

---

## 3. Utils ëª¨ë“ˆ ìƒì„¸

### 3.1 ëª¨ë“ˆë³„ ì˜ì¡´ì„±

```
app.py
â”œâ”€â”€ utils/stt.py
â”‚   â””â”€â”€ google.genai (Gemini API)
â”œâ”€â”€ utils/db_manager.py
â”‚   â””â”€â”€ sqlite3
â”œâ”€â”€ utils/vector_db_manager.py
â”‚   â”œâ”€â”€ chromadb
â”‚   â”œâ”€â”€ langchain_openai (Embedding)
â”‚   â””â”€â”€ utils/db_manager.py (ì˜ì¡´ ì£¼ì…)
â”œâ”€â”€ utils/chat_manager.py
â”‚   â”œâ”€â”€ utils/vector_db_manager.py
â”‚   â””â”€â”€ google.genai (Gemini API)
â”œâ”€â”€ utils/firebase_auth.py
â”‚   â””â”€â”€ firebase_admin
â”œâ”€â”€ utils/user_manager.py
â”‚   â””â”€â”€ sqlite3
â”œâ”€â”€ utils/decorators.py
â”‚   â””â”€â”€ utils/user_manager.py
â””â”€â”€ utils/analysis.py
    â””â”€â”€ sqlite3
```

### 3.2 í™˜ê²½ ë³€ìˆ˜ (.env)

```bash
# API í‚¤
GOOGLE_API_KEY=AIza...          # Gemini API
OPENAI_API_KEY=sk-proj-...      # OpenAI Embedding

# ê´€ë¦¬ì ì´ë©”ì¼ (ì½¤ë§ˆ êµ¬ë¶„)
ADMIN_EMAILS=admin@example.com,admin2@example.com

# Flask ì‹œí¬ë¦¿ í‚¤
SECRET_KEY=your-secret-key

# ë°ì´í„°ë² ì´ìŠ¤ ê²½ë¡œ (ì„ íƒ)
DB_PATH=database/minute_ai.db
```

---

## 4. Database ìŠ¤í‚¤ë§ˆ

### 4.1 SQLite í…Œì´ë¸”

#### users
```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    google_id TEXT UNIQUE,
    email TEXT UNIQUE NOT NULL,
    name TEXT,
    profile_picture TEXT,
    role TEXT DEFAULT 'user',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### meeting_dialogues
```sql
CREATE TABLE meeting_dialogues (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    meeting_id TEXT NOT NULL,
    owner_id INTEGER NOT NULL,
    title TEXT NOT NULL,
    meeting_date TEXT,
    audio_file TEXT NOT NULL,
    speaker_label TEXT,
    start_time REAL,
    segment TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (owner_id) REFERENCES users(id)
);
CREATE INDEX idx_meeting_id ON meeting_dialogues(meeting_id);
CREATE INDEX idx_owner_id ON meeting_dialogues(owner_id);
```

#### meeting_minutes
```sql
CREATE TABLE meeting_minutes (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    meeting_id TEXT UNIQUE NOT NULL,
    owner_id INTEGER NOT NULL,
    title TEXT,
    meeting_date TEXT,
    summary TEXT,
    mindmap_json TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (owner_id) REFERENCES users(id)
);
CREATE INDEX idx_minutes_meeting_id ON meeting_minutes(meeting_id);
```

#### meeting_shares
```sql
CREATE TABLE meeting_shares (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    meeting_id TEXT NOT NULL,
    owner_id INTEGER NOT NULL,
    shared_with_user_id INTEGER NOT NULL,
    permission TEXT DEFAULT 'read',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (owner_id) REFERENCES users(id),
    FOREIGN KEY (shared_with_user_id) REFERENCES users(id),
    UNIQUE(meeting_id, shared_with_user_id)
);
```

### 4.2 ChromaDB ì»¬ë ‰ì…˜

#### meeting_chunks
- **Document ID**: `{meeting_id}_chunk_{index}`
- **Metadata**: meeting_id, title, meeting_date, start_time, end_time, speaker_count
- **Document**: ì •ì œëœ ëŒ€í™” í…ìŠ¤íŠ¸ (ë©”íƒ€ë°ì´í„° ì œê±°)

#### meeting_subtopic
- **Document ID**: `{meeting_id}_summary_{index}`
- **Metadata**: meeting_id, meeting_title, meeting_date, main_topic
- **Document**: ë¬¸ë‹¨ ìš”ì•½ (ë§ˆí¬ë‹¤ìš´ í˜•ì‹)

---

## 5. ë””ë²„ê¹… ê°€ì´ë“œ

### 5.1 ìì£¼ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜

#### 1) ì—…ë¡œë“œ ì‹¤íŒ¨

**ì¦ìƒ:** íŒŒì¼ ì—…ë¡œë“œ í›„ ì§„í–‰ ì•ˆ ë¨

**ì²´í¬ë¦¬ìŠ¤íŠ¸:**
```bash
1. uploads/ í´ë” ê¶Œí•œ í™•ì¸
   ls -ld uploads/
   chmod 755 uploads/

2. GOOGLE_API_KEY í™•ì¸
   grep GOOGLE_API_KEY .env

3. ffmpeg ì„¤ì¹˜ í™•ì¸ (MP4 ë¹„ë””ì˜¤)
   ffmpeg -version

4. ë¡œê·¸ í™•ì¸
   tail -f logs/app.log
```

**ë””ë²„ê¹… í¬ì¸íŠ¸:**
- `app.py:334` - SSE yield ë¡œê·¸
- `utils/stt.py:20` - Gemini API ì‘ë‹µ
- `utils/db_manager.py:87` - DB ì €ì¥ ì˜¤ë¥˜

---

#### 2) ì±—ë´‡ ì‘ë‹µ ì—†ìŒ

**ì¦ìƒ:** ì§ˆë¬¸ ì…ë ¥ í›„ ë¬´í•œ ë¡œë”©

**ì²´í¬ë¦¬ìŠ¤íŠ¸:**
```bash
1. OPENAI_API_KEY í™•ì¸ (ì„ë² ë”©ìš©)
   grep OPENAI_API_KEY .env

2. ChromaDB ë°ì´í„° í™•ì¸
   ls -l database/vector_db/chroma.sqlite3

3. ì ‘ê·¼ ê°€ëŠ¥í•œ ë…¸íŠ¸ í™•ì¸
   # Python ì½˜ì†”
   from utils.user_manager import get_user_accessible_meeting_ids
   get_user_accessible_meeting_ids(user_id=1)
```

**ë””ë²„ê¹… í¬ì¸íŠ¸:**
- `app.py:824` - accessible_meeting_ids í™•ì¸
- `utils/chat_manager.py:39` - ê²€ìƒ‰ ê²°ê³¼ ê°œìˆ˜
- `utils/vector_db_manager.py:368` - ë²¡í„° ê²€ìƒ‰ ì˜¤ë¥˜

---

#### 3) ê¶Œí•œ ì˜¤ë¥˜ (403 Forbidden)

**ì¦ìƒ:** ë…¸íŠ¸ ì ‘ê·¼ ì‹œ 403 ì—ëŸ¬

**ì²´í¬ë¦¬ìŠ¤íŠ¸:**
```bash
1. ì„¸ì…˜ í™•ì¸
   # ë¸Œë¼ìš°ì € ì½˜ì†”
   sessionStorage
   # user_id ì¡´ì¬ ì—¬ë¶€

2. DB ê¶Œí•œ í™•ì¸
   sqlite3 database/minute_ai.db
   SELECT owner_id FROM meeting_dialogues WHERE meeting_id = 'meeting_xxx';

3. Admin ê¶Œí•œ í™•ì¸
   SELECT email, role FROM users WHERE id = 1;
```

**ë””ë²„ê¹… í¬ì¸íŠ¸:**
- `utils/user_manager.py:138` - `can_access_meeting()`
- `utils/decorators.py:12` - `@login_required`

---

#### 4) Firebase ë¡œê·¸ì¸ ì‹¤íŒ¨

**ì¦ìƒ:** Google ë¡œê·¸ì¸ í›„ ì„¸ì…˜ ì—†ìŒ

**ì²´í¬ë¦¬ìŠ¤íŠ¸:**
```bash
1. firebase-adminsdk.json í™•ì¸
   ls -l firebase-adminsdk.json
   cat firebase-adminsdk.json | jq .

2. Firebase í”„ë¡œì íŠ¸ ì„¤ì •
   # Firebase Console â†’ Project Settings â†’ Service Accounts

3. ID Token í™•ì¸
   # ë¸Œë¼ìš°ì € ì½˜ì†” (í”„ë¡ íŠ¸ì—”ë“œ)
   console.log(idToken);
```

**ë””ë²„ê¹… í¬ì¸íŠ¸:**
- `utils/firebase_auth.py:43` - `verify_id_token()`
- `app.py:739` - `/api/login`

---

### 5.2 ë¡œê·¸ í™•ì¸ ë°©ë²•

#### Flask ì½˜ì†” ë¡œê·¸
```bash
# ê°œë°œ ì„œë²„ ì‹¤í–‰ ì‹œ ì½˜ì†” í™•ì¸
python app.py

# ì£¼ìš” ë¡œê·¸
âœ… VectorDBManager initialized
âœ… ChatManager ì´ˆê¸°í™” ì™„ë£Œ
âœ… Firebase Admin SDK ì´ˆê¸°í™” ì™„ë£Œ
âœ… ìŠ¤ë§ˆíŠ¸ ì²­í‚¹ìœ¼ë¡œ Nê°œì˜ ì²­í¬ ìƒì„± ì™„ë£Œ
```

#### SQLite ì§ì ‘ ì¡°íšŒ
```bash
sqlite3 database/minute_ai.db

# ë…¸íŠ¸ ëª©ë¡
SELECT meeting_id, title, owner_id FROM meeting_dialogues GROUP BY meeting_id;

# ê³µìœ  í˜„í™©
SELECT * FROM meeting_shares;

# ì‚¬ìš©ì ëª©ë¡
SELECT id, email, role FROM users;
```

#### ChromaDB ì§ì ‘ ì¡°íšŒ
```python
import chromadb
client = chromadb.PersistentClient(path="database/vector_db")

# ì»¬ë ‰ì…˜ ëª©ë¡
print(client.list_collections())

# ë°ì´í„° í™•ì¸
collection = client.get_collection("meeting_chunks")
print(collection.count())
```

---

### 5.3 ì„±ëŠ¥ í”„ë¡œíŒŒì¼ë§

#### STT ì†ë„ ì¸¡ì •
```python
# utils/stt.py
import time

start = time.time()
segments = transcribe_audio(audio_path)
elapsed = time.time() - start

print(f"STT ì†Œìš” ì‹œê°„: {elapsed:.2f}ì´ˆ")
print(f"ì˜¤ë””ì˜¤ ê¸¸ì´: {audio_duration:.2f}ì´ˆ")
print(f"ì²˜ë¦¬ ì†ë„ ë¹„ìœ¨: {audio_duration/elapsed:.2f}x")
```

#### ì±—ë´‡ ì‘ë‹µ ì†ë„ ì¸¡ì •
```python
# utils/chat_manager.py
import time

start = time.time()
result = self.process_query(query, ...)
elapsed = time.time() - start

print(f"ì±—ë´‡ ì‘ë‹µ ì‹œê°„: {elapsed:.2f}ì´ˆ")
```

#### ë²¡í„° ê²€ìƒ‰ ì†ë„ ì¸¡ì •
```python
# utils/vector_db_manager.py
import time

start = time.time()
results = self.search(db_type="chunks", query=query, k=3)
elapsed = time.time() - start

print(f"ë²¡í„° ê²€ìƒ‰ ì‹œê°„: {elapsed:.2f}ì´ˆ")
```

---

## ğŸ“Œ ë¹ ë¥¸ ì°¸ì¡° ì¹˜íŠ¸ì‹œíŠ¸

### íŒŒì¼ ì—…ë¡œë“œ í”Œë¡œìš°
```
index.html (ë“œë˜ê·¸ì•¤ë“œë¡­)
  â†“
app.py:334 /upload (SSE)
  â†“
utils/stt.py:20 transcribe_audio()
  â†“
utils/db_manager.py:87 save_meeting_dialogue()
  â†“
utils/vector_db_manager.py:116 add_meeting_as_chunk()
  â†“
utils/stt.py:152 generate_summary_from_chunks()
  â†“
mindmap.py:15 generate_mindmap_from_summary()
  â†“
viewer.html (íšŒì˜ë¡ ë·°ì–´)
```

### ì±—ë´‡ ì§ˆì˜ í”Œë¡œìš°
```
script.js (ì±—ë´‡ ì…ë ¥)
  â†“
app.py:824 /api/chat
  â†“
utils/chat_manager.py:319 process_query()
  â†“
utils/vector_db_manager.py:368 search()
  â†“
utils/chat_manager.py:254 generate_answer()
  â†“
script.js (ë‹µë³€ í‘œì‹œ)
```

### ê¶Œí•œ ì²´í¬ í”Œë¡œìš°
```
@login_required (decorators.py:12)
  â†“
session['user_id'] í™•ì¸
  â†“
utils/user_manager.py:138 can_access_meeting()
  â†“
1. Admin? â†’ OK
2. owner_id == user_id? â†’ OK
3. meeting_shares? â†’ OK
  â†“
403 Forbidden or í—ˆìš©
```

---

**ì‘ì„±ì:** Claude Code
**ìµœì¢… ìˆ˜ì •:** 2025-11-11
**ë²„ì „:** 1.0
