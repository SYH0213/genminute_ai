# ë°±ì—”ë“œ ì™„ë²½ ê°€ì´ë“œ - Minute AI ì‹œìŠ¤í…œ

> 1íƒ€ ê°•ì‚¬ì˜ ë°±ì—”ë“œ & ë°ì´í„°ë² ì´ìŠ¤ ì™„ì „ ì •ë³µ
> ì´ ë¬¸ì„œ í•˜ë‚˜ë©´ ì „ì²´ ì‹œìŠ¤í…œì„ ì™„ë²½íˆ ì´í•´í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
> ì‘ì„±ì¼: 2025-11-11

---

## ğŸ“š ëª©ì°¨

1. [ì•„í‚¤í…ì²˜ ê°œìš”](#1-ì•„í‚¤í…ì²˜-ê°œìš”)
2. [ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„](#2-ë°ì´í„°ë² ì´ìŠ¤-ì„¤ê³„)
3. [ë°±ì—”ë“œ ì½”ì–´ ëª¨ë“ˆ](#3-ë°±ì—”ë“œ-ì½”ì–´-ëª¨ë“ˆ)
4. [API ì—”ë“œí¬ì¸íŠ¸](#4-api-ì—”ë“œí¬ì¸íŠ¸)
5. [ì‹¤ì „ ì‹œë‚˜ë¦¬ì˜¤](#5-ì‹¤ì „-ì‹œë‚˜ë¦¬ì˜¤)
6. [ìµœì í™”ì™€ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤](#6-ìµœì í™”ì™€-ë² ìŠ¤íŠ¸-í”„ë™í‹°ìŠ¤)

---

## 1. ì•„í‚¤í…ì²˜ ê°œìš”

### 1.1 ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Flask Application                     â”‚
â”‚                        (app.py)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                       â”‚
        â–¼                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Core Utils  â”‚        â”‚   Database   â”‚
â”‚              â”‚        â”‚              â”‚
â”‚ â€¢ stt.py     â”‚â—„â”€â”€â”€â”€â”€â”€â–ºâ”‚ â€¢ SQLite     â”‚
â”‚ â€¢ db_manager â”‚        â”‚ â€¢ ChromaDB   â”‚
â”‚ â€¢ vector_db  â”‚        â”‚              â”‚
â”‚ â€¢ chat_mgr   â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚ â€¢ user_mgr   â”‚
â”‚ â€¢ firebase   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ External APIsâ”‚
â”‚              â”‚
â”‚ â€¢ Gemini AI  â”‚
â”‚ â€¢ Firebase   â”‚
â”‚ â€¢ OpenAI     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 ê¸°ìˆ  ìŠ¤íƒ

| ê³„ì¸µ | ê¸°ìˆ  | ìš©ë„ |
|------|------|------|
| **ì›¹ í”„ë ˆì„ì›Œí¬** | Flask 3.0 | HTTP ìš”ì²­/ì‘ë‹µ ì²˜ë¦¬ |
| **WSGI** | Werkzeug | ê°œë°œ ì„œë²„, íŒŒì¼ ì—…ë¡œë“œ |
| **ê´€ê³„í˜• DB** | SQLite3 | ë©”íƒ€ë°ì´í„° ì €ì¥ |
| **ë²¡í„° DB** | ChromaDB + LangChain | RAG ê²€ìƒ‰ |
| **AI** | Gemini 2.5 Pro/Flash | STT, ìš”ì•½, ì±—ë´‡ |
| **ì„ë² ë”©** | OpenAI text-embedding-3-small | ë²¡í„°í™” |
| **ì¸ì¦** | Firebase Auth | êµ¬ê¸€ OAuth |

### 1.3 ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
minute_ai/
â”œâ”€â”€ app.py                 # Flask ë©”ì¸ ì• í”Œë¦¬ì¼€ì´ì…˜
â”œâ”€â”€ utils/                 # í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”œâ”€â”€ stt.py            # ìŒì„± ì¸ì‹ & AI ìƒì„±
â”‚   â”œâ”€â”€ db_manager.py     # SQLite CRUD
â”‚   â”œâ”€â”€ vector_db_manager.py  # ChromaDB ê´€ë¦¬
â”‚   â”œâ”€â”€ chat_manager.py   # RAG ì±—ë´‡
â”‚   â”œâ”€â”€ user_manager.py   # ì‚¬ìš©ì/ê¶Œí•œ ê´€ë¦¬
â”‚   â”œâ”€â”€ firebase_auth.py  # Firebase ì¸ì¦
â”‚   â”œâ”€â”€ validation.py     # ì…ë ¥ê°’ ê²€ì¦
â”‚   â”œâ”€â”€ decorators.py     # ì¸ì¦ ë°ì½”ë ˆì´í„°
â”‚   â””â”€â”€ analysis.py       # í™”ì ë¶„ì„
â”œâ”€â”€ database/             # ë°ì´í„° ì €ì¥ì†Œ
â”‚   â”œâ”€â”€ minute_ai.db      # SQLite íŒŒì¼
â”‚   â””â”€â”€ vector_db/        # ChromaDB ë°ì´í„°
â””â”€â”€ uploads/              # ì—…ë¡œë“œ íŒŒì¼
```

---

## 2. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### 2.1 SQLite ìŠ¤í‚¤ë§ˆ

#### 2.1.1 users í…Œì´ë¸”

```sql
CREATE TABLE users (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    firebase_uid TEXT UNIQUE NOT NULL,     -- Firebase ê³ ìœ  ID
    email TEXT UNIQUE NOT NULL,            -- ì´ë©”ì¼
    display_name TEXT,                     -- í‘œì‹œ ì´ë¦„
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP
);
```

**ì—­í• **: Firebase ì‚¬ìš©ìì™€ ë‚´ë¶€ user_id ë§¤í•‘

**í•µì‹¬ ë¡œì§**:
```python
# utils/user_manager.py:15-45
def get_or_create_user(firebase_uid: str, email: str, display_name: str = None):
    """Firebase UIDë¡œ ì‚¬ìš©ì ì¡°íšŒ, ì—†ìœ¼ë©´ ìƒì„±"""
    user = db.execute("SELECT * FROM users WHERE firebase_uid = ?", (firebase_uid,))
    if not user:
        db.execute(
            "INSERT INTO users (firebase_uid, email, display_name) VALUES (?, ?, ?)",
            (firebase_uid, email, display_name)
        )
    return user['id']
```

#### 2.1.2 meetings í…Œì´ë¸”

```sql
CREATE TABLE meetings (
    id TEXT PRIMARY KEY,                   -- UUID v4
    title TEXT NOT NULL,                   -- íšŒì˜ ì œëª©
    meeting_date TIMESTAMP NOT NULL,       -- íšŒì˜ ë‚ ì§œ
    audio_file TEXT NOT NULL,              -- íŒŒì¼ëª… (UUID.í™•ì¥ì)
    owner_id INTEGER NOT NULL,             -- ìƒì„±ì user_id
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (owner_id) REFERENCES users(id)
);
```

**ì¸ë±ìŠ¤**:
```sql
CREATE INDEX idx_meetings_owner ON meetings(owner_id);
CREATE INDEX idx_meetings_date ON meetings(meeting_date DESC);
```

#### 2.1.3 meeting_dialogues í…Œì´ë¸”

```sql
CREATE TABLE meeting_dialogues (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    meeting_id TEXT NOT NULL,              -- meetings.id FK
    speaker_label TEXT NOT NULL,           -- "í™”ì1", "í™”ì2"...
    start_time REAL NOT NULL,              -- ì‹œì‘ ì‹œê°„ (ì´ˆ)
    segment TEXT NOT NULL,                 -- ëŒ€í™” ë‚´ìš©
    confidence REAL,                       -- ì‹ ë¢°ë„ (0.0-1.0)
    FOREIGN KEY (meeting_id) REFERENCES meetings(id) ON DELETE CASCADE
);
```

**ì¸ë±ìŠ¤**:
```sql
CREATE INDEX idx_dialogues_meeting ON meeting_dialogues(meeting_id);
CREATE INDEX idx_dialogues_time ON meeting_dialogues(start_time);
```

**ì¿¼ë¦¬ ì˜ˆì‹œ**:
```python
# íŠ¹ì • íšŒì˜ì˜ ëª¨ë“  ëŒ€í™” ì¡°íšŒ (ì‹œê°„ìˆœ)
dialogues = db.execute("""
    SELECT speaker_label, start_time, segment
    FROM meeting_dialogues
    WHERE meeting_id = ?
    ORDER BY start_time ASC
""", (meeting_id,))

# íŠ¹ì • í™”ìì˜ ë°œì–¸ë§Œ ì¡°íšŒ
speaker_1_dialogues = db.execute("""
    SELECT * FROM meeting_dialogues
    WHERE meeting_id = ? AND speaker_label = ?
""", (meeting_id, "í™”ì1"))
```

#### 2.1.4 meeting_minutes í…Œì´ë¸”

```sql
CREATE TABLE meeting_minutes (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    meeting_id TEXT UNIQUE NOT NULL,       -- meetings.id FK
    title TEXT NOT NULL,
    meeting_date TIMESTAMP NOT NULL,
    content TEXT NOT NULL,                 -- ë§ˆí¬ë‹¤ìš´ íšŒì˜ë¡
    mindmap_content TEXT,                  -- ë§ˆí¬ë‹¤ìš´ ë§ˆì¸ë“œë§µ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (meeting_id) REFERENCES meetings(id) ON DELETE CASCADE
);
```

#### 2.1.5 meeting_shares í…Œì´ë¸”

```sql
CREATE TABLE meeting_shares (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    meeting_id TEXT NOT NULL,              -- meetings.id FK
    shared_with_user_id INTEGER NOT NULL,  -- users.id FK
    permission TEXT DEFAULT 'read',        -- 'read', 'write', 'admin'
    shared_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (meeting_id) REFERENCES meetings(id) ON DELETE CASCADE,
    FOREIGN KEY (shared_with_user_id) REFERENCES users(id) ON DELETE CASCADE,
    UNIQUE(meeting_id, shared_with_user_id)
);
```

**ê¶Œí•œ ì²´í¬ ë¡œì§**:
```python
# utils/user_manager.py:137-165
def can_access_meeting(user_id: int, meeting_id: str) -> bool:
    """ì‚¬ìš©ìê°€ íšŒì˜ì— ì ‘ê·¼ ê°€ëŠ¥í•œì§€ í™•ì¸"""
    # 1. ë³¸ì¸ ì†Œìœ  í™•ì¸
    meeting = db.execute("SELECT owner_id FROM meetings WHERE id = ?", (meeting_id,))
    if meeting and meeting['owner_id'] == user_id:
        return True

    # 2. ê³µìœ ë°›ì•˜ëŠ”ì§€ í™•ì¸
    share = db.execute("""
        SELECT 1 FROM meeting_shares
        WHERE meeting_id = ? AND shared_with_user_id = ?
    """, (meeting_id, user_id))
    if share:
        return True

    # 3. ê´€ë¦¬ì í™•ì¸
    if is_admin(user_id):
        return True

    return False
```

### 2.2 ChromaDB ì»¬ë ‰ì…˜

#### 2.2.1 meeting_chunks ì»¬ë ‰ì…˜

**ëª©ì **: ì‹¤ì œ ëŒ€í™” ë‚´ìš© ì €ì¥ (RAG ê²€ìƒ‰ìš©)

**Document êµ¬ì¡°**:
```python
{
    "id": "{meeting_id}_chunk_{index}",
    "text": "ì²­í¬ í…ìŠ¤íŠ¸ (í™”ì/ì‹œê°„ ì •ë³´ ì œê±°ë¨)",
    "metadata": {
        "meeting_id": "uuid",
        "dialogue_id": "{meeting_id}_chunk_{index}",
        "chunk_index": 0,
        "title": "íšŒì˜ ì œëª©",
        "meeting_date": "2025-11-10",
        "audio_file": "uuid.mp3",
        "start_time": 120.5,      # ì´ˆ
        "end_time": 180.2,        # ì´ˆ
        "speaker_count": 2        # ì´ ì²­í¬ì˜ í™”ì ìˆ˜
    },
    "embedding": [0.1, 0.2, ...]  # 1536ì°¨ì› ë²¡í„°
}
```

**ìƒì„± ë¡œì§**:
```python
# utils/vector_db_manager.py:116-171
def add_meeting_as_chunk(meeting_id, title, meeting_date, audio_file, segments):
    # 1. ìŠ¤ë§ˆíŠ¸ ì²­í‚¹ (í™”ì ë³€ê²½, ì‹œê°„ ê°„ê²©, í¬ê¸° ê³ ë ¤)
    chunks = self._create_smart_chunks(segments, max_chunk_size=1000, time_gap_threshold=60)

    # 2. ê° ì²­í¬ì˜ í…ìŠ¤íŠ¸ ì •ì œ (í™”ì/ì‹œê°„ ì •ë³´ ì œê±°)
    for chunk in chunks:
        chunk['text'] = self._clean_text(chunk['text'])

    # 3. Vector DBì— ì €ì¥
    chunk_vdb.add_texts(
        texts=[chunk['text'] for chunk in chunks],
        metadatas=[{
            "meeting_id": meeting_id,
            "title": title,
            "start_time": chunk['start_time'],
            "end_time": chunk['end_time'],
            # ... ê¸°íƒ€ ë©”íƒ€ë°ì´í„°
        } for chunk in chunks],
        ids=[f"{meeting_id}_chunk_{i}" for i in range(len(chunks))]
    )
```

**ìŠ¤ë§ˆíŠ¸ ì²­í‚¹ ì•Œê³ ë¦¬ì¦˜**:
```python
# utils/vector_db_manager.py:230-310
def _create_smart_chunks(segments, max_chunk_size=1000, time_gap_threshold=60):
    """í™”ì ë³€ê²½, ì‹œê°„ ê°„ê²©, í¬ê¸°ë¥¼ ê³ ë ¤í•œ ì²­í‚¹"""
    chunks = []
    current_chunk = []
    current_speaker = None
    last_time = 0

    for seg in segments:
        speaker = seg['speaker_label']
        start_time = seg['start_time']
        text = seg['segment']

        # ì²­í¬ ë¶„ë¦¬ ì¡°ê±´
        should_split = (
            # 1. í™”ì ë³€ê²½
            (speaker != current_speaker and current_speaker is not None) or
            # 2. ì‹œê°„ ê°„ê²© ì´ˆê³¼ (1ë¶„)
            (start_time - last_time > time_gap_threshold) or
            # 3. í¬ê¸° ì´ˆê³¼ (1000ì)
            (len(''.join([s['segment'] for s in current_chunk])) + len(text) > max_chunk_size)
        )

        if should_split and current_chunk:
            # í˜„ì¬ ì²­í¬ ì €ì¥
            chunks.append({
                'text': format_chunk(current_chunk),
                'start_time': current_chunk[0]['start_time'],
                'end_time': current_chunk[-1]['start_time'],
                'speaker_count': len(set(s['speaker_label'] for s in current_chunk))
            })
            current_chunk = []

        current_chunk.append(seg)
        current_speaker = speaker
        last_time = start_time

    return chunks
```

#### 2.2.2 meeting_subtopic ì»¬ë ‰ì…˜

**ëª©ì **: ì£¼ì œë³„ ìš”ì•½ ì €ì¥ (RAG ê²€ìƒ‰ìš©)

**Document êµ¬ì¡°**:
```python
{
    "id": "{meeting_id}_summary_{index}",
    "text": "ìš”ì•½ í…ìŠ¤íŠ¸ (ë§ˆí¬ë‹¤ìš´)",
    "metadata": {
        "meeting_id": "uuid",
        "meeting_title": "íšŒì˜ ì œëª©",
        "meeting_date": "2025-11-10",
        "audio_file": "uuid.mp3",
        "main_topic": "ì£¼ì œ ì œëª©",        # ### ì œëª© ì¶”ì¶œ
        "summary_index": 0
    },
    "embedding": [0.1, 0.2, ...]
}
```

**ìƒì„± ë¡œì§**:
```python
# utils/vector_db_manager.py:313-363
def add_summary_as_subtopic(meeting_id, title, meeting_date, audio_file, summary_text):
    # 1. ### ì œëª©ìœ¼ë¡œ ìš”ì•½ ë¶„ë¦¬
    subtopics = self._split_summary_by_heading(summary_text)

    # 2. ê° ì£¼ì œë³„ë¡œ ì €ì¥
    for i, (main_topic, content) in enumerate(subtopics):
        subtopic_vdb.add_texts(
            texts=[content],
            metadatas=[{
                "meeting_id": meeting_id,
                "meeting_title": title,
                "main_topic": main_topic,
                "summary_index": i
            }],
            ids=[f"{meeting_id}_summary_{i}"]
        )
```

### 2.3 ë°ì´í„° íë¦„ ë‹¤ì´ì–´ê·¸ë¨

```
[íŒŒì¼ ì—…ë¡œë“œ]
    â†“
[app.py] íŒŒì¼ ì €ì¥ (uploads/)
    â†“
[stt.py] Gemini STT â†’ segments
    â†“
[db_manager.py] meetings í…Œì´ë¸”ì— INSERT
    â†“
[db_manager.py] meeting_dialogues í…Œì´ë¸”ì— INSERT (ê° segment)
    â†“
[vector_db_manager.py] meeting_chunksì— ADD (ì²­í‚¹ í›„)
    â†“
[stt.py] Geminië¡œ ìš”ì•½ ìƒì„±
    â†“
[vector_db_manager.py] meeting_subtopicì— ADD (ì£¼ì œë³„ ë¶„ë¦¬)
    â†“
[stt.py] ë§ˆì¸ë“œë§µ ìƒì„±
    â†“
[db_manager.py] meeting_minutes í…Œì´ë¸”ì— INSERT
```

---

## 3. ë°±ì—”ë“œ ì½”ì–´ ëª¨ë“ˆ

### 3.1 app.py - Flask ì• í”Œë¦¬ì¼€ì´ì…˜

#### 3.1.1 ì´ˆê¸°í™” ì½”ë“œ

```python
# app.py:36-69
app = Flask(__name__)
app.config['SECRET_KEY'] = os.getenv('FLASK_SECRET_KEY')
app.config['UPLOAD_FOLDER'] = os.path.join(basedir, "uploads")
# ì£¼ì˜: MAX_CONTENT_LENGTH ë¯¸ì„¤ì • (í˜„ì¬ 16MB ì œí•œ)

# ì „ì—­ ê°ì²´ ì´ˆê¸°í™”
db = DatabaseManager(DB_PATH)
stt_manager = STTManager()
vdb_manager.db_manager = db
chat_manager = ChatManager(vdb_manager, retriever_type="similarity")
```

#### 3.1.2 ì£¼ìš” ë¼ìš°íŠ¸

**1) íŒŒì¼ ì—…ë¡œë“œ & ì²˜ë¦¬ (`/api/upload`)**

```python
# app.py:392-554
@app.route("/api/upload", methods=["POST"])
@login_required
def upload():
    """
    íšŒì˜ ë…¹ìŒ íŒŒì¼ ì—…ë¡œë“œ & ì „ì²´ íŒŒì´í”„ë¼ì¸ ì‹¤í–‰

    Flow:
    1. íŒŒì¼ ê²€ì¦ & ì €ì¥
    2. MP4 â†’ WAV ë³€í™˜ (í•„ìš”ì‹œ)
    3. Gemini STT ì‹¤í–‰
    4. SQLite ì €ì¥
    5. ChromaDB ì €ì¥
    6. ìš”ì•½ & ë§ˆì¸ë“œë§µ ìƒì„±
    7. SSEë¡œ ì§„í–‰ë¥  ì „ì†¡
    """
    # === Phase 1: íŒŒì¼ ê²€ì¦ ===
    title = request.form.get("title", "").strip()
    meeting_date_str = request.form.get("meeting_date", "").strip()
    file = request.files.get("audio_file")

    if not title or not meeting_date_str or not file:
        return jsonify({"success": False, "error": "í•„ìˆ˜ ì…ë ¥ê°’"}), 400

    # ì œëª© ê²€ì¦ (validation.py ì‚¬ìš©)
    is_valid, error_msg = validate_title(title)
    if not is_valid:
        return jsonify({"success": False, "error": error_msg}), 400

    # ë‚ ì§œ íŒŒì‹±
    meeting_date = parse_meeting_date(meeting_date_str)

    # === Phase 2: íŒŒì¼ ì €ì¥ ===
    filename = secure_filename(file.filename)
    unique_filename = f"{uuid.uuid4().hex}_{filename}"
    file_path = os.path.join(app.config["UPLOAD_FOLDER"], unique_filename)
    file.save(file_path)

    # === Phase 3: MP4 ë³€í™˜ (í•„ìš”ì‹œ) ===
    if filename.endswith('.mp4'):
        audio_path = file_path.replace('.mp4', '_audio.wav')
        success = convert_video_to_audio(file_path, audio_path)
        if not success:
            return jsonify({"error": "MP4 ë³€í™˜ ì‹¤íŒ¨"}), 500
        file_path = audio_path

    # === Phase 4: STT ì‹¤í–‰ ===
    segments = stt_manager.transcribe_audio(file_path, filename)
    if not segments:
        return jsonify({"error": "ìŒì„± ì¸ì‹ ì‹¤íŒ¨"}), 500

    # === Phase 5: SQLite ì €ì¥ ===
    meeting_id = str(uuid.uuid4())
    db.save_meeting_info(meeting_id, title, meeting_date, unique_filename, owner_id=user_id)

    for seg in segments:
        db.save_segment(meeting_id, seg['speaker_label'], seg['start_time'], seg['segment'], seg['confidence'])

    # === Phase 6: ChromaDB ì €ì¥ (ì²­í‚¹) ===
    vdb_manager.add_meeting_as_chunk(meeting_id, title, meeting_date, unique_filename, segments)

    # === Phase 7: ìš”ì•½ ìƒì„± ===
    transcript = "\n".join([f"Speaker {s['speaker_label']}: {s['segment']}" for s in segments])
    summary = stt_manager.subtopic_generate(title, transcript)

    # ChromaDBì— ìš”ì•½ ì €ì¥
    vdb_manager.add_summary_as_subtopic(meeting_id, title, meeting_date, unique_filename, summary)

    # === Phase 8: ë§ˆì¸ë“œë§µ ìƒì„± ===
    mindmap = stt_manager.extract_mindmap_keywords(summary, title)

    # === Phase 9: íšŒì˜ë¡ ì €ì¥ ===
    db.save_minutes(meeting_id, title, meeting_date, minutes_content="ìë™ ìƒì„±", mindmap_content=mindmap)

    return jsonify({"success": True, "meeting_id": meeting_id})
```

**SSE ì§„í–‰ë¥  ì „ì†¡ (ë³„ë„ ë¼ìš°íŠ¸)**:
```python
# app.py:556-631
@app.route("/api/upload_with_progress", methods=["POST"])
@login_required
def upload_with_progress():
    """SSEë¡œ ì‹¤ì‹œê°„ ì§„í–‰ë¥  ì „ì†¡"""
    def generate():
        # 20%: íŒŒì¼ ì €ì¥
        yield f"data: {json.dumps({'progress': 20, 'message': 'íŒŒì¼ ì €ì¥ ì™„ë£Œ'})}\n\n"

        # 40%: STT ì‹œì‘
        yield f"data: {json.dumps({'progress': 40, 'message': 'ìŒì„± ì¸ì‹ ì¤‘...'})}\n\n"
        segments = stt_manager.transcribe_audio(file_path)

        # 60%: DB ì €ì¥
        yield f"data: {json.dumps({'progress': 60, 'message': 'DB ì €ì¥ ì¤‘...'})}\n\n"

        # ... (ìƒëµ)

        # 100%: ì™„ë£Œ
        yield f"data: {json.dumps({'progress': 100, 'message': 'ì™„ë£Œ!'})}\n\n"

    return Response(stream_with_context(generate()), mimetype='text/event-stream')
```

**2) ì±—ë´‡ API (`/api/chat`)**

```python
# app.py:1112-1165
@app.route("/api/chat", methods=["POST"])
@login_required
def chat():
    """
    RAG ì±—ë´‡ API

    Request:
    {
        "query": "ë‹¤ìŒ íšŒì˜ ì¼ì •ì€?",
        "meeting_id": "uuid" (optional)
    }

    Response:
    {
        "success": true,
        "answer": "11ì›” 15ì¼ì…ë‹ˆë‹¤.",
        "sources": [
            {
                "type": "chunk",
                "meeting_id": "uuid",
                "title": "1ì°¨íšŒì˜",
                "start_time": 120,
                "end_time": 180
            }
        ]
    }
    """
    user_id = session['user_id']
    data = request.get_json()
    query = data.get("query", "").strip()
    meeting_id = data.get("meeting_id")  # optional

    if not query:
        return jsonify({"error": "ì§ˆë¬¸ ì…ë ¥ í•„ìš”"}), 400

    # ê¶Œí•œ ì²´í¬
    if meeting_id:
        if not can_access_meeting(user_id, meeting_id):
            return jsonify({"error": "ì ‘ê·¼ ê¶Œí•œ ì—†ìŒ"}), 403
        accessible_meeting_ids = None
    else:
        # ì „ì²´ ë…¸íŠ¸ ê²€ìƒ‰
        accessible_meeting_ids = get_user_accessible_meeting_ids(user_id)
        if not accessible_meeting_ids:
            return jsonify({
                "success": True,
                "answer": "ì ‘ê·¼ ê°€ëŠ¥í•œ ë…¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.",
                "sources": []
            })

    # ChatManagerë¡œ ì²˜ë¦¬
    result = chat_manager.process_query(query, meeting_id, accessible_meeting_ids)
    return jsonify(result)
```

**3) íšŒì˜ë¡ ì‚­ì œ (`/api/delete_meeting`)**

```python
# app.py:1086-1110
@app.route("/api/delete_meeting/<string:meeting_id>", methods=["POST"])
@login_required
def delete_meeting(meeting_id):
    """
    íšŒì˜ ì „ì²´ ì‚­ì œ (Cascade)

    ì‚­ì œ ëŒ€ìƒ:
    - SQLite: meetings, meeting_dialogues, meeting_minutes, meeting_shares
    - ChromaDB: meeting_chunks, meeting_subtopic
    - FileSystem: uploads/{audio_file}
    """
    user_id = session['user_id']

    # ê¶Œí•œ ì²´í¬ (ì†Œìœ ì or Admin)
    if not can_access_meeting(user_id, meeting_id):
        return jsonify({"error": "ê¶Œí•œ ì—†ìŒ"}), 403

    # VectorDBManagerì˜ í†µí•© ì‚­ì œ ë©”ì„œë“œ í˜¸ì¶œ
    result = vdb_manager.delete_from_collection(db_type="all", meeting_id=meeting_id)
    return jsonify(result)
```

### 3.2 utils/stt.py - ìŒì„± ì¸ì‹ & AI ìƒì„±

#### 3.2.1 STT ì‹¤í–‰

```python
# utils/stt.py:29-152
class STTManager:
    def transcribe_audio(self, audio_path: str, original_filename: str):
        """
        Gemini 2.5 Proë¡œ ìŒì„± ì¸ì‹

        Args:
            audio_path: ë¡œì»¬ íŒŒì¼ ê²½ë¡œ
            original_filename: ì›ë³¸ íŒŒì¼ëª…

        Returns:
            List[Dict]: [
                {
                    "id": 0,
                    "speaker": 1,
                    "start_time": 0.0,
                    "confidence": 0.95,
                    "text": "ì•ˆë…•í•˜ì„¸ìš”"
                },
                ...
            ]
        """
        # 1. íŒŒì¼ ì½ê¸°
        with open(audio_path, "rb") as f:
            file_bytes = f.read()

        # 2. MIME íƒ€ì… ê²°ì •
        file_ext = os.path.splitext(audio_path)[1].lower()
        mime_type_map = {
            ".wav": "audio/wav",
            ".mp3": "audio/mp3",
            ".m4a": "audio/mp4",
            ".flac": "audio/flac",
        }
        mime_type = mime_type_map.get(file_ext, "audio/wav")

        # 3. í”„ë¡¬í”„íŠ¸ êµ¬ì„± (ë§¤ìš° ìƒì„¸í•¨)
        prompt = """
        ë‹¹ì‹ ì€ ìµœê³  ìˆ˜ì¤€ì˜ ì •í™•ë„ë¥¼ ê°€ì§„ ì „ë¬¸ì ì¸ íšŒì˜ë¡ STT ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

        [í•µì‹¬ ì§€ì¹¨]
        1. ì¶©ì‹¤ë„ ìš°ì„ : ì‹¤ì œ ë°œí™”ëœ ë‚´ìš©ë§Œ ì¸ì‹
        2. ê¸ˆì§€ ì‚¬í•­: ë¬¸ì¥ ë³´ì • ì˜¤ë¥˜, ë™ì‚¬ ìƒì„±/ë³´ì •, ë¶ˆí•„ìš”í•œ ë‹¨ì–´ ì¶”ê°€
        3. í™”ì ë¶„ë¦¬: ë™ì¼ í™”ìëŠ” ê°™ì€ ë²ˆí˜¸ ìœ ì§€
        4. ê²¹ì¹¨ ì²˜ë¦¬: ë™ì‹œ ë°œí™”ëŠ” ê°ê° ì‹œê°„ ê¸°ë¡

        [ì¶œë ¥ í˜•ì‹]
        [
            {
                "speaker": 1,
                "start_time_mmss": "0:00:000",
                "confidence": 0.95,
                "text": "ì•ˆë…•í•˜ì„¸ìš”. íšŒì˜ë¥¼ ì‹œì‘í•˜ê² ìŠµë‹ˆë‹¤."
            }
        ]
        JSON ë°°ì—´ë§Œ ì¶œë ¥.
        """

        # 4. Gemini API í˜¸ì¶œ
        response = client.models.generate_content(
            model="gemini-2.5-pro",
            contents=[prompt, types.Part.from_bytes(data=file_bytes, mime_type=mime_type)]
        )

        # 5. JSON íŒŒì‹±
        cleaned_response = response.text.strip().replace("```json", "").replace("```", "")
        result_list = json.loads(cleaned_response)

        # 6. ì •ê·œí™” (start_timeì„ ì´ˆ ë‹¨ìœ„ë¡œ ë³€í™˜)
        normalized_segments = []
        for idx, segment in enumerate(result_list):
            normalized_segments.append({
                "id": idx,
                "speaker": segment.get("speaker", 1),
                "start_time": self._parse_mmss_to_seconds(segment.get("start_time_mmss", "0:00:000")),
                "confidence": segment.get("confidence", 0.0),
                "text": segment.get("text", ""),
            })

        return normalized_segments
```

#### 3.2.2 ìš”ì•½ ìƒì„±

```python
# utils/stt.py:154-271
def subtopic_generate(self, title: str, transcript_text: str):
    """
    Geminië¡œ ì£¼ì œë³„ ìš”ì•½ ìƒì„±

    Args:
        title: íšŒì˜ ì œëª©
        transcript_text: ì „ì²´ ëŒ€í™” ë‚´ìš©

    Returns:
        str: ë§ˆí¬ë‹¤ìš´ ìš”ì•½
    """
    prompt = f"""
    ë‹¹ì‹ ì€ ì œê³µëœ ëŒ€í™” ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë¶„ì„í•˜ì—¬ êµ¬ì¡°í™”ëœ ì£¼ì œë³„ ìš”ì•½ë³¸ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” AIì…ë‹ˆë‹¤.

    [ì¶œë ¥ ìš”êµ¬ì‚¬í•­]
    1. íšŒì˜ ì œëª©: {title}
    2. ì£¼ì œë³„ ê·¸ë£¹í™”
    3. ì†Œì£¼ì œ ì œëª©: **ë°˜ë“œì‹œ "### ì œëª©" í˜•ì‹**
    4. ë‚´ìš© ìš”ì•½: ê¸€ë¨¸ë¦¬ ê¸°í˜¸(*) ì‚¬ìš©
    5. ë¬¸ì²´ ë³€í™˜: êµ¬ì–´ì²´ â†’ ë¬¸ì–´ì²´
    6. í™”ì ì œê±°: 'A:', 'B:' ì œê±°
    7. ì œëª©ê³¼ ë‚´ìš© ê°„ê²©: ì œëª© ë°”ë¡œ ë‹¤ìŒ ì¤„ì— ë‚´ìš©
    8. ë¬¸ë‹¨ ê°„ê²©: ì†Œì£¼ì œ ì‚¬ì´ ì¤„ë°”ê¿ˆ 2ê°œ
    9. ì •í™•í•œ ì¸ìš©: [cite: 1, 2] í˜•ì‹

    [ì¶œë ¥ ì˜ˆì‹œ]
    ### ì²« ë²ˆì§¸ ì£¼ìš” ì£¼ì œ
    * ì²« ë²ˆì§¸ ë…¼ì˜ ë‚´ìš© ìš”ì•½ [cite: 1]
    * ë‘ ë²ˆì§¸ ë…¼ì˜ ë‚´ìš© ìš”ì•½ [cite: 2, 3]

    ### ë‘ ë²ˆì§¸ ì£¼ìš” ì£¼ì œ
    * ì„¸ ë²ˆì§¸ ë…¼ì˜ ë‚´ìš© ìš”ì•½ [cite: 4]
    """

    response = client.models.generate_content(
        model="gemini-2.5-flash",
        contents=prompt
    )

    return response.text.strip()
```

#### 3.2.3 ë§ˆì¸ë“œë§µ ìƒì„±

```python
# utils/stt.py:432-526
def extract_mindmap_keywords(self, summary_text: str, title: str):
    """
    Geminië¡œ ë§ˆì¸ë“œë§µ ìƒì„±

    Args:
        summary_text: ìš”ì•½ í…ìŠ¤íŠ¸
        title: íšŒì˜ ì œëª©

    Returns:
        str: ë§ˆí¬ë‹¤ìš´ ë§ˆì¸ë“œë§µ

    ì˜ˆì‹œ:
    # 1ì°¨íšŒì˜
    ## ì£¼ìš” ì•ˆê±´
    ### í”„ë¡œì íŠ¸ ì¼ì •
    - 11ì›” 15ì¼ ì™„ë£Œ
    ### ì˜ˆì‚°
    - 20ë§Œì›
    """
    prompt = f"""
    ë‹¹ì‹ ì€ íšŒì˜ë¡ ìš”ì•½ìœ¼ë¡œë¶€í„° ë§ˆì¸ë“œë§µì„ ìƒì„±í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.

    [ì¤‘ìš” ê·œì¹™]
    1. ìµœìƒìœ„ ì œëª©(#)ì€ ë°˜ë“œì‹œ íšŒì˜ ì œëª©ë§Œ ì‚¬ìš©: # {title}
    2. "Mind Map", "ë§ˆì¸ë“œë§µ" ê°™ì€ ë‹¨ì–´ë¥¼ ìµœìƒìœ„ì— ë‘ì§€ ë§ˆì„¸ìš”
    3. 2ë‹¨ê³„(##)ë¶€í„° ì‹¤ì œ ì£¼ì œ ì‹œì‘
    4. ìµœëŒ€ ê¹Šì´ 4ë‹¨ê³„(####)
    5. ê° ë…¸ë“œëŠ” 5-10ë‹¨ì–´

    [ì¶œë ¥ í˜•ì‹]
    # {title}
    ## ì²« ë²ˆì§¸ ì£¼ì œ
    ### ìƒì„¸ í•­ëª©
    - ë‚´ìš©
    """

    response = client.models.generate_content(
        model="gemini-2.5-flash",
        contents=prompt
    )

    return response.text.strip()
```

### 3.3 utils/db_manager.py - SQLite ê´€ë¦¬

```python
# utils/db_manager.py (ì£¼ìš” ë©”ì„œë“œë§Œ)

class DatabaseManager:
    def __init__(self, db_path: str):
        self.db_path = db_path
        self._init_db()

    def _get_connection(self):
        """ë§¤ ìš”ì²­ë§ˆë‹¤ ìƒˆ ì—°ê²° ìƒì„± (Thread-safe)"""
        conn = sqlite3.connect(self.db_path)
        conn.row_factory = sqlite3.Row  # Dictì²˜ëŸ¼ ì‚¬ìš© ê°€ëŠ¥
        return conn

    def save_meeting_info(self, meeting_id, title, meeting_date, audio_file, owner_id):
        """meetings í…Œì´ë¸”ì— INSERT"""
        with self._get_connection() as conn:
            conn.execute("""
                INSERT INTO meetings (id, title, meeting_date, audio_file, owner_id)
                VALUES (?, ?, ?, ?, ?)
            """, (meeting_id, title, meeting_date, audio_file, owner_id))
            conn.commit()

    def save_segment(self, meeting_id, speaker_label, start_time, segment, confidence):
        """meeting_dialogues í…Œì´ë¸”ì— INSERT"""
        with self._get_connection() as conn:
            conn.execute("""
                INSERT INTO meeting_dialogues
                (meeting_id, speaker_label, start_time, segment, confidence)
                VALUES (?, ?, ?, ?, ?)
            """, (meeting_id, speaker_label, start_time, segment, confidence))
            conn.commit()

    def get_meeting_by_id(self, meeting_id):
        """meetings ì¡°íšŒ"""
        with self._get_connection() as conn:
            cursor = conn.execute("SELECT * FROM meetings WHERE id = ?", (meeting_id,))
            return cursor.fetchone()

    def get_dialogues_by_meeting(self, meeting_id):
        """meeting_dialogues ì¡°íšŒ (ì‹œê°„ìˆœ)"""
        with self._get_connection() as conn:
            cursor = conn.execute("""
                SELECT * FROM meeting_dialogues
                WHERE meeting_id = ?
                ORDER BY start_time ASC
            """, (meeting_id,))
            return cursor.fetchall()

    def delete_meeting(self, meeting_id):
        """
        íšŒì˜ ì‚­ì œ (Cascade)

        ìˆœì„œ:
        1. meeting_shares ì‚­ì œ
        2. meeting_minutes ì‚­ì œ
        3. meeting_dialogues ì‚­ì œ (FK cascade)
        4. meetings ì‚­ì œ
        5. ì˜¤ë””ì˜¤ íŒŒì¼ ì‚­ì œ
        """
        with self._get_connection() as conn:
            # íŒŒì¼ ê²½ë¡œ ì¡°íšŒ
            meeting = conn.execute("SELECT audio_file FROM meetings WHERE id = ?", (meeting_id,)).fetchone()
            audio_file = meeting['audio_file'] if meeting else None

            # DB ì‚­ì œ (FK CASCADEë¡œ ìë™ ì‚­ì œë¨)
            conn.execute("DELETE FROM meetings WHERE id = ?", (meeting_id,))
            conn.commit()

            # íŒŒì¼ ì‚­ì œ
            if audio_file:
                file_path = os.path.join(UPLOAD_FOLDER, audio_file)
                if os.path.exists(file_path):
                    os.remove(file_path)
```

### 3.4 utils/vector_db_manager.py - ChromaDB ê´€ë¦¬

```python
# utils/vector_db_manager.py (í•µì‹¬ ë©”ì„œë“œ)

class VectorDBManager:
    def __init__(self):
        # ChromaDB í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
        self.client = chromadb.PersistentClient(path="./database/vector_db")

        # OpenAI Embeddings
        self.embeddings = OpenAIEmbeddings(
            model="text-embedding-3-small",
            openai_api_key=os.getenv("OPENAI_API_KEY")
        )

        # 2ê°œ ì»¬ë ‰ì…˜ ìƒì„±
        self.vectorstores = {
            "chunks": Chroma(
                client=self.client,
                collection_name="meeting_chunks",
                embedding_function=self.embeddings
            ),
            "subtopic": Chroma(
                client=self.client,
                collection_name="meeting_subtopic",
                embedding_function=self.embeddings
            )
        }

    def search(self, db_type: str, query: str, k: int = 5,
               retriever_type: str = "similarity", filter_criteria: dict = None):
        """
        ë²¡í„° ê²€ìƒ‰

        Args:
            db_type: "chunks" or "subtopic"
            query: ê²€ìƒ‰ ì¿¼ë¦¬
            k: ë°˜í™˜ ê°œìˆ˜
            retriever_type: "similarity", "mmr", "self_query"
            filter_criteria: ë©”íƒ€ë°ì´í„° í•„í„° (ì˜ˆ: {"meeting_id": "uuid"})

        Returns:
            List[Document]
        """
        vdb = self.vectorstores[db_type]

        # Similarity Search
        if retriever_type == "similarity":
            search_kwargs = {'k': k}
            if filter_criteria:
                search_kwargs['filter'] = filter_criteria

            retriever = vdb.as_retriever(
                search_type="similarity",
                search_kwargs=search_kwargs
            )
            results = retriever.invoke(query)
            return results

    def delete_from_collection(self, db_type: str, meeting_id: str):
        """
        íŠ¹ì • íšŒì˜ì˜ ëª¨ë“  ë²¡í„° ì‚­ì œ

        Args:
            db_type: "chunks", "subtopic", "all"
            meeting_id: ì‚­ì œí•  íšŒì˜ ID
        """
        if db_type == "all":
            # ì–‘ìª½ ì»¬ë ‰ì…˜ì—ì„œ ì‚­ì œ
            self.delete_from_collection("chunks", meeting_id)
            self.delete_from_collection("subtopic", meeting_id)

            # SQLiteë„ ì‚­ì œ
            self.db_manager.delete_meeting(meeting_id)
            return {"success": True}

        # í•´ë‹¹ meeting_idì˜ ëª¨ë“  Document ID ì¡°íšŒ
        collection = self.client.get_collection(self.COLLECTION_NAMES[db_type])
        results = collection.get(where={"meeting_id": meeting_id})

        if results['ids']:
            collection.delete(ids=results['ids'])
            print(f"âœ… {db_type}ì—ì„œ {len(results['ids'])}ê°œ ë¬¸ì„œ ì‚­ì œ")
```

### 3.5 utils/chat_manager.py - RAG ì±—ë´‡

```python
# utils/chat_manager.py (í•µì‹¬ ë©”ì„œë“œ)

class ChatManager:
    def __init__(self, vector_db_manager, retriever_type="similarity"):
        self.vdb_manager = vector_db_manager
        self.retriever_type = retriever_type
        self.gemini_client = genai.Client(api_key=os.getenv("GOOGLE_API_KEY"))
        self.model_name = "gemini-2.5-flash"

    def process_query(self, query: str, meeting_id: str = None,
                     accessible_meeting_ids: list = None):
        """
        ì‚¬ìš©ì ì§ˆì˜ ì²˜ë¦¬ (RAG íŒŒì´í”„ë¼ì¸)

        Flow:
        1. ë²¡í„° ê²€ìƒ‰ (chunks 3ê°œ + subtopic 3ê°œ)
        2. ì»¨í…ìŠ¤íŠ¸ í¬ë§·íŒ…
        3. Geminië¡œ ë‹µë³€ ìƒì„±
        4. ì¶œì²˜ ì •ë³´ ì¶”ê°€

        Args:
            query: ì‚¬ìš©ì ì§ˆë¬¸
            meeting_id: íŠ¹ì • íšŒì˜ë¡œ ì œí•œ (optional)
            accessible_meeting_ids: ì ‘ê·¼ ê°€ëŠ¥í•œ íšŒì˜ ID ëª©ë¡

        Returns:
            {
                "success": True,
                "answer": "ë‹µë³€ í…ìŠ¤íŠ¸",
                "sources": [...]
            }
        """
        # 1. ë¬¸ì„œ ê²€ìƒ‰
        search_results = self.search_documents(query, meeting_id, accessible_meeting_ids)

        if search_results["total_count"] == 0:
            return {
                "success": True,
                "answer": "ì£„ì†¡í•©ë‹ˆë‹¤. ê´€ë ¨ ë‚´ìš©ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",
                "sources": []
            }

        # 2. ì»¨í…ìŠ¤íŠ¸ í¬ë§·íŒ…
        context = self.format_context(search_results)

        # 3. ë‹µë³€ ìƒì„±
        result = self.generate_answer(query, context)

        # 4. ì¶œì²˜ ì •ë³´ ì¶”ê°€
        sources = []
        for doc in search_results["chunks"]:
            meta = doc.metadata
            sources.append({
                "type": "chunk",
                "meeting_id": meta.get("meeting_id"),
                "title": meta.get("title"),
                "start_time": meta.get("start_time"),
                "end_time": meta.get("end_time")
            })

        return {
            "success": True,
            "answer": result["answer"],
            "sources": sources
        }

    def search_documents(self, query: str, meeting_id: str = None,
                        accessible_meeting_ids: list = None):
        """
        chunks + subtopics ì´ì¤‘ ê²€ìƒ‰

        Returns:
            {
                "chunks": [Document, ...],     # 3ê°œ
                "subtopics": [Document, ...],  # 3ê°œ
                "total_count": 6
            }
        """
        if accessible_meeting_ids:
            # ì—¬ëŸ¬ ë…¸íŠ¸ì—ì„œ ê²€ìƒ‰
            chunk_result = self.vdb_manager.search(
                db_type="chunks",
                query=query,
                k=len(accessible_meeting_ids) * 10,  # ë„‰ë„‰í•˜ê²Œ
                retriever_type=self.retriever_type
            )
            # ì ‘ê·¼ ê°€ëŠ¥í•œ meeting_idë¡œ í•„í„°ë§
            chunks = [doc for doc in chunk_result
                     if doc.metadata.get('meeting_id') in accessible_meeting_ids]

            subtopic_result = self.vdb_manager.search(
                db_type="subtopic",
                query=query,
                k=len(accessible_meeting_ids) * 10
            )
            subtopics = [doc for doc in subtopic_result
                        if doc.metadata.get('meeting_id') in accessible_meeting_ids]

            # ìƒìœ„ 3ê°œì”©ë§Œ
            chunks = chunks[:3]
            subtopics = subtopics[:3]
        else:
            # ë‹¨ì¼ ë…¸íŠ¸ ê²€ìƒ‰
            chunks = self.vdb_manager.search("chunks", query, k=3, filter_criteria={"meeting_id": meeting_id} if meeting_id else None)
            subtopics = self.vdb_manager.search("subtopic", query, k=3, filter_criteria={"meeting_id": meeting_id} if meeting_id else None)

        return {
            "chunks": chunks,
            "subtopics": subtopics,
            "total_count": len(chunks) + len(subtopics)
        }

    def format_context(self, search_results: dict):
        """
        ê²€ìƒ‰ ê²°ê³¼ë¥¼ í”„ë¡¬í”„íŠ¸ í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…
        """
        parts = []

        # Chunks
        if search_results["chunks"]:
            parts.append("=== íšŒì˜ ëŒ€í™” ë‚´ìš© ===")
            for i, doc in enumerate(search_results["chunks"], 1):
                meta = doc.metadata
                parts.append(f"""
[ë¬¸ì„œ {i}]
íšŒì˜: {meta.get('title', 'N/A')}
ì¼ì‹œ: {meta.get('meeting_date', 'N/A')}
ì‹œê°„: {meta.get('start_time', 0):.0f}ì´ˆ - {meta.get('end_time', 0):.0f}ì´ˆ
ë‚´ìš©:
{doc.page_content}
""")

        # Subtopics
        if search_results["subtopics"]:
            parts.append("\n=== íšŒì˜ ì£¼ì œë³„ ìš”ì•½ ===")
            for i, doc in enumerate(search_results["subtopics"], 1):
                meta = doc.metadata
                parts.append(f"""
[ìš”ì•½ {i}]
íšŒì˜: {meta.get('meeting_title', 'N/A')}
ì£¼ì œ: {meta.get('main_topic', 'N/A')}
ë‚´ìš©:
{doc.page_content}
""")

        return "\n".join(parts)

    def generate_answer(self, query: str, context: str):
        """
        Geminië¡œ ë‹µë³€ ìƒì„± (í• ë£¨ì‹œë„¤ì´ì…˜ ë°©ì§€)
        """
        prompt = f"""
ë‹¹ì‹ ì€ íšŒì˜ë¡ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ ì‚¬ìš©ìì˜ ì§ˆë¬¸ì— ë‹µë³€í•˜ëŠ” ì „ë¬¸ ë¹„ì„œ ì±—ë´‡ì…ë‹ˆë‹¤.

[ì§€ì‹œ ì‚¬í•­]
1. **ë°˜ë“œì‹œ** ì•„ë˜ [ê²€ìƒ‰ëœ íšŒì˜ë¡ ë‚´ìš©] **ì•ˆì—ì„œë§Œ** ì •ë³´ë¥¼ ì°¾ì•„ì„œ ë‹µë³€
2. ì •ë³´ê°€ ì—†ë‹¤ë©´ "ì£„ì†¡í•©ë‹ˆë‹¤. í•´ë‹¹ ë‚´ìš©ì„ íšŒì˜ë¡ì—ì„œ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."
3. ì ˆëŒ€ë¡œ ì‚¬ì „ ì§€ì‹ì´ë‚˜ ì™¸ë¶€ ì •ë³´ ì‚¬ìš© ê¸ˆì§€
4. ë‹µë³€ì€ ëª…í™•í•˜ê³  ê°„ê²°í•˜ê²Œ
5. **ì¤‘ìš”**: íšŒì˜ ì œëª©ê³¼ ë‚ ì§œëŠ” ë©”íƒ€ë°ì´í„° ì°¸ì¡° (ë³¸ë¬¸ ë¬´ì‹œ)

---

[ê²€ìƒ‰ëœ íšŒì˜ë¡ ë‚´ìš©]:
{context}

---

[ì‚¬ìš©ì ì§ˆë¬¸]:
{query}

---

[ë‹µë³€]:
"""

        response = self.gemini_client.models.generate_content(
            model=self.model_name,
            contents=prompt
        )

        return {
            "success": True,
            "answer": response.text.strip()
        }
```

### 3.6 utils/user_manager.py - ì‚¬ìš©ì & ê¶Œí•œ ê´€ë¦¬

```python
# utils/user_manager.py (í•µì‹¬ í•¨ìˆ˜ë“¤)

def get_or_create_user(firebase_uid: str, email: str, display_name: str = None):
    """Firebase UIDë¡œ ì‚¬ìš©ì ì¡°íšŒ ë˜ëŠ” ìƒì„±"""
    with db._get_connection() as conn:
        user = conn.execute(
            "SELECT * FROM users WHERE firebase_uid = ?",
            (firebase_uid,)
        ).fetchone()

        if not user:
            conn.execute("""
                INSERT INTO users (firebase_uid, email, display_name, last_login)
                VALUES (?, ?, ?, ?)
            """, (firebase_uid, email, display_name, datetime.now()))
            conn.commit()
            user = conn.execute(
                "SELECT * FROM users WHERE firebase_uid = ?",
                (firebase_uid,)
            ).fetchone()

    return user

def can_access_meeting(user_id: int, meeting_id: str) -> bool:
    """
    ì ‘ê·¼ ê¶Œí•œ ì²´í¬

    í—ˆìš© ì¡°ê±´:
    1. ë³¸ì¸ ì†Œìœ  (owner_id == user_id)
    2. ê³µìœ ë°›ìŒ (meeting_sharesì— ì¡´ì¬)
    3. ê´€ë¦¬ì (ADMIN_EMAILS)
    """
    with db._get_connection() as conn:
        # 1. ì†Œìœ ì í™•ì¸
        meeting = conn.execute(
            "SELECT owner_id FROM meetings WHERE id = ?",
            (meeting_id,)
        ).fetchone()

        if meeting and meeting['owner_id'] == user_id:
            return True

        # 2. ê³µìœ  í™•ì¸
        share = conn.execute("""
            SELECT 1 FROM meeting_shares
            WHERE meeting_id = ? AND shared_with_user_id = ?
        """, (meeting_id, user_id)).fetchone()

        if share:
            return True

        # 3. ê´€ë¦¬ì í™•ì¸
        if is_admin(user_id):
            return True

    return False

def get_user_accessible_meeting_ids(user_id: int) -> list:
    """
    ì‚¬ìš©ìê°€ ì ‘ê·¼ ê°€ëŠ¥í•œ ëª¨ë“  meeting_id ì¡°íšŒ

    Returns:
        ["uuid1", "uuid2", ...]
    """
    with db._get_connection() as conn:
        # 1. ë³¸ì¸ ì†Œìœ 
        owned = conn.execute(
            "SELECT id FROM meetings WHERE owner_id = ?",
            (user_id,)
        ).fetchall()

        # 2. ê³µìœ ë°›ì€ ê²ƒ
        shared = conn.execute("""
            SELECT meeting_id FROM meeting_shares
            WHERE shared_with_user_id = ?
        """, (user_id,)).fetchall()

        # 3. í•©ì¹˜ê¸°
        meeting_ids = [row['id'] for row in owned] + [row['meeting_id'] for row in shared]
        return list(set(meeting_ids))  # ì¤‘ë³µ ì œê±°

def share_meeting(meeting_id: str, owner_id: int, target_email: str, permission: str = "read"):
    """
    íšŒì˜ë¡ ê³µìœ 

    Args:
        meeting_id: ê³µìœ í•  íšŒì˜
        owner_id: ê³µìœ í•˜ëŠ” ì‚¬ëŒ
        target_email: ê³µìœ ë°›ì„ ì‚¬ëŒ ì´ë©”ì¼
        permission: 'read', 'write', 'admin'
    """
    # 1. ê¶Œí•œ ì²´í¬ (ë³¸ì¸ ì†Œìœ ì¸ì§€)
    if not can_edit_meeting(owner_id, meeting_id):
        raise PermissionError("ê³µìœ  ê¶Œí•œ ì—†ìŒ")

    # 2. ëŒ€ìƒ ì‚¬ìš©ì ì¡°íšŒ
    with db._get_connection() as conn:
        target_user = conn.execute(
            "SELECT id FROM users WHERE email = ?",
            (target_email,)
        ).fetchone()

        if not target_user:
            raise ValueError("ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤")

        # 3. ê³µìœ  ë“±ë¡ (ì¤‘ë³µ ì‹œ ë¬´ì‹œ)
        conn.execute("""
            INSERT OR IGNORE INTO meeting_shares
            (meeting_id, shared_with_user_id, permission)
            VALUES (?, ?, ?)
        """, (meeting_id, target_user['id'], permission))
        conn.commit()

def is_admin(user_id: int) -> bool:
    """ê´€ë¦¬ì í™•ì¸ (.envì˜ ADMIN_EMAILS)"""
    with db._get_connection() as conn:
        user = conn.execute("SELECT email FROM users WHERE id = ?", (user_id,)).fetchone()
        if not user:
            return False

        admin_emails = os.getenv("ADMIN_EMAILS", "").split(",")
        return user['email'] in admin_emails
```

---

## 4. API ì—”ë“œí¬ì¸íŠ¸

### 4.1 ì¸ì¦ ê´€ë ¨

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì¸ì¦ | ì„¤ëª… |
|-----------|--------|------|------|
| `/login` | GET | âŒ | ë¡œê·¸ì¸ í˜ì´ì§€ |
| `/callback` | GET | âŒ | Firebase ì¸ì¦ ì½œë°± |
| `/logout` | GET | âœ… | ë¡œê·¸ì•„ì›ƒ |

### 4.2 ë©”ì¸ í˜ì´ì§€

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì¸ì¦ | ì„¤ëª… |
|-----------|--------|------|------|
| `/` | GET | âœ… | ë©”ì¸ í˜ì´ì§€ (íšŒì˜ë¡ ëª©ë¡) |
| `/viewer/<meeting_id>` | GET | âœ… | íšŒì˜ë¡ ìƒì„¸ë³´ê¸° |
| `/shared-notes` | GET | âœ… | ê³µìœ ë°›ì€ ë…¸íŠ¸ ëª©ë¡ |

### 4.3 íŒŒì¼ ì—…ë¡œë“œ & ì²˜ë¦¬

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì¸ì¦ | ì„¤ëª… |
|-----------|--------|------|------|
| `/api/upload` | POST | âœ… | íŒŒì¼ ì—…ë¡œë“œ & ì „ì²´ íŒŒì´í”„ë¼ì¸ |
| `/api/upload_with_progress` | POST | âœ… | SSEë¡œ ì§„í–‰ë¥  ì „ì†¡ |
| `/api/script` | POST | âœ… | í…ìŠ¤íŠ¸ ì§ì ‘ ì…ë ¥ (STT ìƒëµ) |

**Request (`/api/upload`)**:
```javascript
FormData {
    "title": "1ì°¨íšŒì˜",
    "meeting_date": "2025-11-10",
    "audio_file": File
}
```

**Response**:
```json
{
    "success": true,
    "meeting_id": "uuid",
    "redirect_url": "/viewer/uuid"
}
```

### 4.4 íšŒì˜ë¡ CRUD

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì¸ì¦ | ì„¤ëª… |
|-----------|--------|------|------|
| `/api/meeting/<meeting_id>` | GET | âœ… | íšŒì˜ ì •ë³´ ì¡°íšŒ |
| `/api/update_title/<meeting_id>` | POST | âœ… | ì œëª© ìˆ˜ì • |
| `/api/delete_meeting/<meeting_id>` | POST | âœ… | íšŒì˜ ì‚­ì œ (Cascade) |

**Request (`/api/update_title`)**:
```json
{
    "new_title": "ìˆ˜ì •ëœ ì œëª©"
}
```

### 4.5 ì±—ë´‡

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì¸ì¦ | ì„¤ëª… |
|-----------|--------|------|------|
| `/api/chat` | POST | âœ… | RAG ì±—ë´‡ ì§ˆì˜ |

**Request**:
```json
{
    "query": "ë‹¤ìŒ íšŒì˜ ì¼ì •ì€?",
    "meeting_id": "uuid" // optional
}
```

**Response**:
```json
{
    "success": true,
    "answer": "11ì›” 15ì¼ì…ë‹ˆë‹¤.",
    "sources": [
        {
            "type": "chunk",
            "meeting_id": "uuid",
            "title": "1ì°¨íšŒì˜",
            "meeting_date": "2025-11-10",
            "start_time": 120,
            "end_time": 180
        }
    ]
}
```

### 4.6 ê³µìœ 

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì¸ì¦ | ì„¤ëª… |
|-----------|--------|------|------|
| `/api/share/<meeting_id>` | POST | âœ… | íšŒì˜ë¡ ê³µìœ  |
| `/api/unshare/<meeting_id>/<user_id>` | POST | âœ… | ê³µìœ  ì·¨ì†Œ |
| `/api/shared_users/<meeting_id>` | GET | âœ… | ê³µìœ  ëª©ë¡ ì¡°íšŒ |

**Request (`/api/share`)**:
```json
{
    "email": "friend@example.com",
    "permission": "read"
}
```

### 4.7 ê´€ë¦¬ì ì „ìš©

| ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì¸ì¦ | ì„¤ëª… |
|-----------|--------|------|------|
| `/test-stt` | GET | Admin | STT í…ŒìŠ¤íŠ¸ í˜ì´ì§€ |
| `/test-mindmap` | GET | Admin | ë§ˆì¸ë“œë§µ í…ŒìŠ¤íŠ¸ |
| `/test-minutes` | GET | Admin | íšŒì˜ë¡ ìƒì„± í…ŒìŠ¤íŠ¸ |

---

## 5. ì‹¤ì „ ì‹œë‚˜ë¦¬ì˜¤

### 5.1 ì‹œë‚˜ë¦¬ì˜¤: íšŒì˜ë¡ ìƒì„±

**ì‚¬ìš©ì ì•¡ì…˜**: íŒŒì¼ ì—…ë¡œë“œ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. í”„ë¡ íŠ¸ì—”ë“œ: POST /api/upload             â”‚
â”‚    FormData {                                â”‚
â”‚      title: "1ì°¨íšŒì˜",                       â”‚
â”‚      meeting_date: "2025-11-10",             â”‚
â”‚      audio_file: File                        â”‚
â”‚    }                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. app.py:392 @upload()                     â”‚
â”‚    - íŒŒì¼ ê²€ì¦ (validation.py)               â”‚
â”‚    - íŒŒì¼ ì €ì¥ (uploads/{uuid}_{filename})  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. stt.py:29 transcribe_audio()             â”‚
â”‚    - Gemini 2.5 Pro API í˜¸ì¶œ                â”‚
â”‚    - ìŒì„± â†’ í…ìŠ¤íŠ¸ ë³€í™˜                      â”‚
â”‚    - í™”ì ë¶„ë¦¬                               â”‚
â”‚    - ê²°ê³¼: segments (List[Dict])             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. db_manager.py                             â”‚
â”‚    - save_meeting_info() â†’ meetings          â”‚
â”‚    - save_segment() Ã— N â†’ meeting_dialogues  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. vector_db_manager.py:116                  â”‚
â”‚    - add_meeting_as_chunk()                  â”‚
â”‚    - ìŠ¤ë§ˆíŠ¸ ì²­í‚¹ (í™”ì/ì‹œê°„/í¬ê¸° ê³ ë ¤)        â”‚
â”‚    - OpenAI ì„ë² ë”©                           â”‚
â”‚    - ChromaDB meeting_chunksì— ì €ì¥          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. stt.py:154 subtopic_generate()           â”‚
â”‚    - Gemini 2.5 Flashë¡œ ìš”ì•½ ìƒì„±           â”‚
â”‚    - ì£¼ì œë³„ ë¶„ë¦¬ (### ì œëª©)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. vector_db_manager.py:313                  â”‚
â”‚    - add_summary_as_subtopic()               â”‚
â”‚    - ìš”ì•½ì„ ì£¼ì œë³„ë¡œ ë¶„ë¦¬                    â”‚
â”‚    - ChromaDB meeting_subtopicì— ì €ì¥        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. stt.py:432 extract_mindmap_keywords()    â”‚
â”‚    - Geminië¡œ ë§ˆì¸ë“œë§µ ìƒì„±                  â”‚
â”‚    - ë§ˆí¬ë‹¤ìš´ í˜•ì‹                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. db_manager.py save_minutes()             â”‚
â”‚    - meeting_minutes í…Œì´ë¸”ì— INSERT         â”‚
â”‚    - content, mindmap_content ì €ì¥           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 10. app.py ì‘ë‹µ                              â”‚
â”‚     {                                        â”‚
â”‚       "success": true,                       â”‚
â”‚       "meeting_id": "uuid",                  â”‚
â”‚       "redirect_url": "/viewer/uuid"         â”‚
â”‚     }                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì†Œìš” ì‹œê°„** (30ë¶„ íšŒì˜):
- STT: 2-3ë¶„
- ì²­í‚¹ & ì„ë² ë”©: 30ì´ˆ
- ìš”ì•½ ìƒì„±: 30ì´ˆ
- ë§ˆì¸ë“œë§µ: 20ì´ˆ
- **ì´ ì•½ 4ë¶„**

### 5.2 ì‹œë‚˜ë¦¬ì˜¤: ì±—ë´‡ ì§ˆì˜

**ì‚¬ìš©ì ì•¡ì…˜**: "ë‹¤ìŒ íšŒì˜ ì¼ì •ì€?" ì§ˆë¬¸

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. í”„ë¡ íŠ¸ì—”ë“œ: POST /api/chat                â”‚
â”‚    {                                         â”‚
â”‚      "query": "ë‹¤ìŒ íšŒì˜ ì¼ì •ì€?",           â”‚
â”‚      "meeting_id": null  // ì „ì²´ ê²€ìƒ‰        â”‚
â”‚    }                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. app.py:1112 @chat()                      â”‚
â”‚    - user_id ì¶”ì¶œ (session)                  â”‚
â”‚    - ê¶Œí•œ ì²´í¬ ìƒëµ (ì „ì²´ ê²€ìƒ‰)              â”‚
â”‚    - accessible_meeting_ids ì¡°íšŒ             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. user_manager.py:401                       â”‚
â”‚    get_user_accessible_meeting_ids(user_id)  â”‚
â”‚    - ë³¸ì¸ ì†Œìœ : SELECT FROM meetings         â”‚
â”‚    - ê³µìœ ë°›ìŒ: SELECT FROM meeting_shares    â”‚
â”‚    - ê²°ê³¼: ["uuid1", "uuid2", "uuid3"]       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. chat_manager.py:319 process_query()      â”‚
â”‚    - search_documents() í˜¸ì¶œ                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. chat_manager.py:39 search_documents()    â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ 5-1. OpenAI Embedding                â”‚  â”‚
â”‚    â”‚      "ë‹¤ìŒ íšŒì˜ ì¼ì •ì€?"              â”‚  â”‚
â”‚    â”‚      â†’ [0.2, 0.8, -0.3, ...] (1536ì°¨ì›) â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ 5-2. ChromaDB Similarity Search      â”‚  â”‚
â”‚    â”‚      meeting_chunks:                 â”‚  â”‚
â”‚    â”‚      - k=30 ê²€ìƒ‰ (ë„‰ë„‰í•˜ê²Œ)          â”‚  â”‚
â”‚    â”‚      - meeting_id í•„í„°ë§              â”‚  â”‚
â”‚    â”‚      - ìƒìœ„ 3ê°œ ì„ íƒ                 â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚    â”‚ 5-3. ChromaDB Similarity Search      â”‚  â”‚
â”‚    â”‚      meeting_subtopic:               â”‚  â”‚
â”‚    â”‚      - k=30 ê²€ìƒ‰                      â”‚  â”‚
â”‚    â”‚      - meeting_id í•„í„°ë§              â”‚  â”‚
â”‚    â”‚      - ìƒìœ„ 3ê°œ ì„ íƒ                 â”‚  â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚    ê²°ê³¼: {                                   â”‚
â”‚      chunks: [Doc1, Doc2, Doc3],             â”‚
â”‚      subtopics: [Doc4, Doc5, Doc6]           â”‚
â”‚    }                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. chat_manager.py:206 format_context()    â”‚
â”‚    ê²€ìƒ‰ ê²°ê³¼ë¥¼ í”„ë¡¬í”„íŠ¸ í˜•ì‹ìœ¼ë¡œ ë³€í™˜         â”‚
â”‚                                              â”‚
â”‚    === íšŒì˜ ëŒ€í™” ë‚´ìš© ===                   â”‚
â”‚    [ë¬¸ì„œ 1]                                  â”‚
â”‚    íšŒì˜: 1ì°¨íšŒì˜                             â”‚
â”‚    ë‚´ìš©: ë‹¤ìŒ íšŒì˜ëŠ” 15ì¼ë¡œ ê²°ì •...          â”‚
â”‚                                              â”‚
â”‚    === íšŒì˜ ì£¼ì œë³„ ìš”ì•½ ===                 â”‚
â”‚    [ìš”ì•½ 1]                                  â”‚
â”‚    ì£¼ì œ: ì¼ì • ë…¼ì˜                           â”‚
â”‚    ë‚´ìš©: 15ì¼ í™•ì •...                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. chat_manager.py:254 generate_answer()   â”‚
â”‚    Gemini 2.5 Flashì— í”„ë¡¬í”„íŠ¸ ì „ì†¡:         â”‚
â”‚                                              â”‚
â”‚    [ê²€ìƒ‰ëœ íšŒì˜ë¡ ë‚´ìš©]: (ìœ„ ì»¨í…ìŠ¤íŠ¸)        â”‚
â”‚    [ì‚¬ìš©ì ì§ˆë¬¸]: ë‹¤ìŒ íšŒì˜ ì¼ì •ì€?          â”‚
â”‚    [ë‹µë³€]:                                   â”‚
â”‚                                              â”‚
â”‚    Gemini ì‘ë‹µ: "11ì›” 15ì¼ì…ë‹ˆë‹¤."          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 8. chat_manager.py:357 ì¶œì²˜ ì •ë³´ ì¶”ê°€       â”‚
â”‚    sources = [                               â”‚
â”‚      {                                       â”‚
â”‚        type: "chunk",                        â”‚
â”‚        meeting_id: "uuid1",                  â”‚
â”‚        title: "1ì°¨íšŒì˜",                     â”‚
â”‚        start_time: 120                       â”‚
â”‚      }                                       â”‚
â”‚    ]                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 9. app.py ì‘ë‹µ                               â”‚
â”‚    {                                         â”‚
â”‚      "success": true,                        â”‚
â”‚      "answer": "11ì›” 15ì¼ì…ë‹ˆë‹¤.",           â”‚
â”‚      "sources": [...]                        â”‚
â”‚    }                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ì†Œìš” ì‹œê°„**: ì•½ 3.77ì´ˆ
- ì„ë² ë”©: 0.5ì´ˆ
- ë²¡í„° ê²€ìƒ‰: 0.5ì´ˆ
- Gemini ë‹µë³€: 2.5ì´ˆ
- ê¸°íƒ€: 0.27ì´ˆ

### 5.3 ì‹œë‚˜ë¦¬ì˜¤: íšŒì˜ë¡ ì‚­ì œ

**ì‚¬ìš©ì ì•¡ì…˜**: íšŒì˜ë¡ ì‚­ì œ ë²„íŠ¼ í´ë¦­

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. í”„ë¡ íŠ¸ì—”ë“œ: POST /api/delete_meeting/uuidâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. app.py:1086 @delete_meeting()            â”‚
â”‚    - user_id ì¶”ì¶œ                            â”‚
â”‚    - can_access_meeting() ê¶Œí•œ ì²´í¬          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. user_manager.py:137 can_access_meeting() â”‚
â”‚    - ë³¸ì¸ ì†Œìœ  í™•ì¸                          â”‚
â”‚    - OR ê´€ë¦¬ì í™•ì¸                          â”‚
â”‚    â†’ Trueì´ë©´ ê³„ì†, Falseì´ë©´ 403            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. vector_db_manager.py:650                  â”‚
â”‚    delete_from_collection(db_type="all")     â”‚
â”‚                                              â”‚
â”‚    4-1. meeting_chunks ì»¬ë ‰ì…˜ ì‚­ì œ           â”‚
â”‚         collection.get(where={meeting_id})   â”‚
â”‚         collection.delete(ids=[...])         â”‚
â”‚                                              â”‚
â”‚    4-2. meeting_subtopic ì»¬ë ‰ì…˜ ì‚­ì œ         â”‚
â”‚         collection.get(where={meeting_id})   â”‚
â”‚         collection.delete(ids=[...])         â”‚
â”‚                                              â”‚
â”‚    4-3. SQLite ì‚­ì œ                          â”‚
â”‚         db_manager.delete_meeting()          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. db_manager.py delete_meeting()           â”‚
â”‚    - audio_file ê²½ë¡œ ì¡°íšŒ                    â”‚
â”‚    - DELETE FROM meetings (FK CASCADE)       â”‚
â”‚      â†’ meeting_dialogues ìë™ ì‚­ì œ           â”‚
â”‚      â†’ meeting_minutes ìë™ ì‚­ì œ             â”‚
â”‚      â†’ meeting_shares ìë™ ì‚­ì œ              â”‚
â”‚    - os.remove(audio_file)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. app.py ì‘ë‹µ                               â”‚
â”‚    {                                         â”‚
â”‚      "success": true,                        â”‚
â”‚      "deleted_chunks": 15,                   â”‚
â”‚      "deleted_subtopics": 5,                 â”‚
â”‚      "deleted_dialogues": 50                 â”‚
â”‚    }                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. ìµœì í™”ì™€ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤

### 6.1 ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”

#### 6.1.1 ì¸ë±ìŠ¤ ì „ëµ

```sql
-- í•„ìˆ˜ ì¸ë±ìŠ¤
CREATE INDEX idx_meetings_owner ON meetings(owner_id);
CREATE INDEX idx_meetings_date ON meetings(meeting_date DESC);
CREATE INDEX idx_dialogues_meeting ON meeting_dialogues(meeting_id);
CREATE INDEX idx_dialogues_time ON meeting_dialogues(start_time);
CREATE INDEX idx_shares_user ON meeting_shares(shared_with_user_id);

-- ë³µí•© ì¸ë±ìŠ¤ (í–¥í›„ ì¶”ê°€ ê³ ë ¤)
CREATE INDEX idx_shares_meeting_user ON meeting_shares(meeting_id, shared_with_user_id);
```

#### 6.1.2 ì¿¼ë¦¬ ìµœì í™”

**Bad**:
```python
# ëª¨ë“  íšŒì˜ ì¡°íšŒ í›„ Pythonì—ì„œ í•„í„°ë§
meetings = db.execute("SELECT * FROM meetings")
my_meetings = [m for m in meetings if m['owner_id'] == user_id]
```

**Good**:
```python
# DBì—ì„œ í•„í„°ë§
my_meetings = db.execute(
    "SELECT * FROM meetings WHERE owner_id = ? ORDER BY meeting_date DESC",
    (user_id,)
)
```

#### 6.1.3 Connection Pool (í–¥í›„ ê°œì„ )

```python
# í˜„ì¬: ë§¤ ìš”ì²­ë§ˆë‹¤ ìƒˆ ì—°ê²°
def _get_connection():
    return sqlite3.connect(self.db_path)

# ê°œì„ : SQLAlchemy ì‚¬ìš©
from sqlalchemy import create_engine
engine = create_engine('sqlite:///minute_ai.db', pool_size=10, max_overflow=20)
```

### 6.2 ChromaDB ìµœì í™”

#### 6.2.1 ì„ë² ë”© ìºì‹±

```python
# í–¥í›„ ê°œì„ : ë™ì¼ í…ìŠ¤íŠ¸ëŠ” ì„ë² ë”© ì¬ì‚¬ìš©
embedding_cache = {}

def get_embedding(text: str):
    if text in embedding_cache:
        return embedding_cache[text]

    embedding = embeddings.embed_query(text)
    embedding_cache[text] = embedding
    return embedding
```

#### 6.2.2 ë°°ì¹˜ ì„ë² ë”©

```python
# Bad: í•˜ë‚˜ì”© ì„ë² ë”©
for chunk in chunks:
    embedding = embeddings.embed_query(chunk['text'])

# Good: ë°°ì¹˜ë¡œ ì„ë² ë”© (10ë°° ë¹ ë¦„)
texts = [chunk['text'] for chunk in chunks]
embeddings_list = embeddings.embed_documents(texts)
```

### 6.3 API í˜¸ì¶œ ìµœì í™”

#### 6.3.1 Rate Limiting

```python
# í–¥í›„ ì¶”ê°€: Flask-Limiter
from flask_limiter import Limiter

limiter = Limiter(
    app,
    default_limits=["200 per hour", "50 per minute"]
)

@app.route("/api/chat")
@limiter.limit("10 per minute")
def chat():
    ...
```

#### 6.3.2 íƒ€ì„ì•„ì›ƒ ì„¤ì •

```python
# Gemini API í˜¸ì¶œ ì‹œ íƒ€ì„ì•„ì›ƒ
response = client.models.generate_content(
    model="gemini-2.5-flash",
    contents=prompt,
    request_options={"timeout": 30}  # 30ì´ˆ
)
```

### 6.4 ë³´ì•ˆ Best Practice

#### 6.4.1 íŒŒì¼ ì—…ë¡œë“œ ë³´ì•ˆ

```python
# 1. í™•ì¥ì í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸
ALLOWED_EXTENSIONS = {"wav", "mp3", "m4a", "flac", "mp4"}

# 2. MIME íƒ€ì… ê²€ì¦ (í–¥í›„ ì¶”ê°€)
import magic
mime = magic.Magic(mime=True)
file_mime = mime.from_buffer(file.read(1024))
if file_mime not in ["audio/wav", "audio/mpeg", "audio/mp4"]:
    raise ValueError("Invalid file type")

# 3. íŒŒì¼ í¬ê¸° ì œí•œ
app.config['MAX_CONTENT_LENGTH'] = 500 * 1024 * 1024  # 500MB
```

#### 6.4.2 SQL Injection ë°©ì§€

```python
# Bad: String formatting âŒ
query = f"SELECT * FROM meetings WHERE id = '{meeting_id}'"

# Good: Parameterized Query âœ…
query = "SELECT * FROM meetings WHERE id = ?"
db.execute(query, (meeting_id,))
```

#### 6.4.3 XSS ë°©ì§€

```python
# Jinja2 ìë™ ì´ìŠ¤ì¼€ì´í”„ (Flask ê¸°ë³¸ê°’)
# {{ user_input }} â†’ ìë™ìœ¼ë¡œ HTML escape

# ì¶”ê°€: ë§ˆí¬ë‹¤ìš´ ë Œë”ë§ ì‹œ sanitize
import bleach
safe_html = bleach.clean(markdown_html, tags=['p', 'h1', 'h2', 'ul', 'li'])
```

### 6.5 ì—ëŸ¬ í•¸ë“¤ë§

#### 6.5.1 ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬

```python
# app.py
@app.errorhandler(404)
def not_found(error):
    return jsonify({"error": "Not found"}), 404

@app.errorhandler(500)
def internal_error(error):
    # ë¡œê¹…
    app.logger.error(f"Internal error: {error}")
    return jsonify({"error": "Internal server error"}), 500

@app.errorhandler(Exception)
def handle_exception(e):
    app.logger.error(f"Unhandled exception: {e}", exc_info=True)
    return jsonify({"error": "An unexpected error occurred"}), 500
```

#### 6.5.2 ì¬ì‹œë„ ë¡œì§

```python
# utils/stt.py
from tenacity import retry, stop_after_attempt, wait_exponential

@retry(
    stop=stop_after_attempt(3),
    wait=wait_exponential(multiplier=1, min=4, max=10)
)
def transcribe_audio(audio_path):
    """ìµœëŒ€ 3íšŒ ì¬ì‹œë„ (ì§€ìˆ˜ ë°±ì˜¤í”„)"""
    return gemini_api_call(audio_path)
```

### 6.6 ë¡œê¹…

```python
# app.py
import logging

logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s [%(levelname)s] %(name)s: %(message)s',
    handlers=[
        logging.FileHandler('app.log'),
        logging.StreamHandler()
    ]
)

logger = logging.getLogger(__name__)

# ì‚¬ìš© ì˜ˆì‹œ
@app.route("/api/upload")
def upload():
    logger.info(f"User {user_id} uploading file: {filename}")
    try:
        # ...
        logger.info(f"Upload successful: {meeting_id}")
    except Exception as e:
        logger.error(f"Upload failed: {e}", exc_info=True)
```

### 6.7 ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

```python
# í–¥í›„ ì¶”ê°€: í•¨ìˆ˜ ì‹¤í–‰ ì‹œê°„ ì¸¡ì •
import time
from functools import wraps

def timing_decorator(func):
    @wraps(func)
    def wrapper(*args, **kwargs):
        start = time.time()
        result = func(*args, **kwargs)
        end = time.time()
        logger.info(f"{func.__name__} took {end - start:.2f}s")
        return result
    return wrapper

@timing_decorator
def transcribe_audio(audio_path):
    # ...
    pass
```

---

## ğŸ“š ì£¼ìš” íŒŒì¼ ì°¸ì¡°

| íŒŒì¼ | í•µì‹¬ ë¼ì¸ | ì„¤ëª… |
|------|----------|------|
| `app.py` | 392-554 | íŒŒì¼ ì—…ë¡œë“œ & íŒŒì´í”„ë¼ì¸ |
| `app.py` | 1112-1165 | ì±—ë´‡ API |
| `utils/stt.py` | 29-152 | Gemini STT |
| `utils/stt.py` | 154-271 | ìš”ì•½ ìƒì„± |
| `utils/stt.py` | 432-526 | ë§ˆì¸ë“œë§µ ìƒì„± |
| `utils/db_manager.py` | ì „ì²´ | SQLite CRUD |
| `utils/vector_db_manager.py` | 116-171 | ì²­í‚¹ & ì €ì¥ |
| `utils/vector_db_manager.py` | 230-310 | ìŠ¤ë§ˆíŠ¸ ì²­í‚¹ ì•Œê³ ë¦¬ì¦˜ |
| `utils/vector_db_manager.py` | 368-483 | ë²¡í„° ê²€ìƒ‰ |
| `utils/chat_manager.py` | 319-387 | RAG íŒŒì´í”„ë¼ì¸ |
| `utils/user_manager.py` | 137-165 | ê¶Œí•œ ì²´í¬ |

---

## ğŸ¯ í•µì‹¬ ê°œë… ìš”ì•½

### 1. ë°ì´í„° íë¦„

```
íŒŒì¼ â†’ STT â†’ SQLite + ChromaDB â†’ ìš”ì•½/ë§ˆì¸ë“œë§µ â†’ ì™„ë£Œ
```

### 2. RAG íŒŒì´í”„ë¼ì¸

```
ì§ˆë¬¸ â†’ ì„ë² ë”© â†’ ë²¡í„° ê²€ìƒ‰ â†’ ì»¨í…ìŠ¤íŠ¸ â†’ Gemini â†’ ë‹µë³€
```

### 3. ê¶Œí•œ ì²´ê³„

```
ë³¸ì¸ ì†Œìœ  OR ê³µìœ ë°›ìŒ OR ê´€ë¦¬ì = ì ‘ê·¼ í—ˆìš©
```

### 4. ë°ì´í„°ë² ì´ìŠ¤

- **SQLite**: ë©”íƒ€ë°ì´í„° (ê´€ê³„í˜•)
- **ChromaDB**: ì‹¤ì œ ë‚´ìš© (ë²¡í„° ê²€ìƒ‰)

### 5. AI ì—­í• 

- **Gemini Pro**: STT (í™”ì ë¶„ë¦¬)
- **Gemini Flash**: ìš”ì•½, ë§ˆì¸ë“œë§µ, ì±—ë´‡
- **OpenAI**: ì„ë² ë”© (1536ì°¨ì›)

---

**ì‘ì„±ì**: 1íƒ€ ë°±ì—”ë“œ ê°•ì‚¬ Claude
**ë‚œì´ë„**: â­â­â­â­â­ (ì „ë¬¸ê°€)
**ëŒ€ìƒ**: ë°±ì—”ë“œ ê°œë°œì, ì‹œìŠ¤í…œ ì•„í‚¤í…íŠ¸
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-11-11

ì´ ë¬¸ì„œ í•˜ë‚˜ë©´ ë°±ì—”ë“œ ì‹œìŠ¤í…œ ì „ì²´ë¥¼ ì™„ë²½íˆ ì´í•´í•˜ê³  ìˆ˜ì •/í™•ì¥í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤! ğŸš€
